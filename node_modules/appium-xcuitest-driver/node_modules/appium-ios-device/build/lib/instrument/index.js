"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.InstrumentService = exports.INSTRUMENT_SERVICE_NAME_VERSION_14 = exports.INSTRUMENT_SERVICE_NAME = exports.INSTRUMENT_CHANNEL = void 0;
require("source-map-support/register");
var _baseService = require("../base-service");
var _headers = require("./headers");
var _dtxEncode = require("./transformer/dtx-encode");
var _dtxDecode = require("./transformer/dtx-decode");
var _events = _interopRequireDefault(require("events"));
var _lodash = _interopRequireDefault(require("lodash"));
var _asyncbox = require("asyncbox");
const CHECK_FREQ_MS = 500;
const WAIT_REPLY_TIME_MS = 10000;
const CHANNEL_CANCELED = '_channelCanceled';
const CHANNEL_OFFSET = 2 ** 32;
const INSTRUMENT_SERVICE_NAME_VERSION_14 = 'com.apple.instruments.remoteserver.DVTSecureSocketProxy';
exports.INSTRUMENT_SERVICE_NAME_VERSION_14 = INSTRUMENT_SERVICE_NAME_VERSION_14;
const INSTRUMENT_SERVICE_NAME = 'com.apple.instruments.remoteserver';
exports.INSTRUMENT_SERVICE_NAME = INSTRUMENT_SERVICE_NAME;
const INSTRUMENT_CHANNEL = Object.freeze({
  DEVICE_INFO: 'com.apple.instruments.server.services.deviceinfo',
  PROCESS_CONTROL: 'com.apple.instruments.server.services.processcontrol',
  SYSMONTAP: 'com.apple.instruments.server.services.sysmontap',
  NETWORKING: 'com.apple.instruments.server.services.networking',
  MOBILE_NOTIFICATIONS: 'com.apple.instruments.server.services.mobilenotifications',
  GRAPHICS_OPENGL: 'com.apple.instruments.server.services.graphics.opengl',
  APPLICATION_LISTING: 'com.apple.instruments.server.services.device.applictionListing',
  CONDITION_INDUCER: 'com.apple.instruments.server.services.ConditionInducer'
});
exports.INSTRUMENT_CHANNEL = INSTRUMENT_CHANNEL;
function defaultDict(createValue) {
  return Proxy.revocable(Object.create(null), {
    get(storage, property) {
      if (!(property in storage)) {
        storage[property] = createValue(property);
      }
      return storage[property];
    }
  });
}
class InstrumentService extends _baseService.BaseServiceSocket {
  constructor(socketClient, event) {
    super(socketClient);
    this._undefinedCallback = event;
    this._callbacks = new _events.default.EventEmitter();
    this._channelCallbacks = new _events.default.EventEmitter();
    const {
      proxy,
      revoke
    } = defaultDict(() => []);
    this._replyQueues = proxy;
    this._replyQueuesRevoker = revoke;
    this._channels = {};
    this._nextIdentifier = 1;
    this._encoder = new _dtxEncode.DTXEncoder();
    this._encoder.pipe(this._socketClient);
    this._assignClientFailureHandlers(this._encoder);
    this._decoder = new _dtxDecode.DTXDecoder();
    this._socketClient.pipe(this._decoder);
    this._decoder.on('data', this._handleData.bind(this));
  }
  registerSelectorCallback(selector, event) {
    this._callbacks.addListener(selector, event);
  }
  registerUndefinedCallback(event) {
    this._undefinedCallback = event;
  }
  async registerChannelCallback(channel, event) {
    const channelId = await this.makeChannel(channel);
    this._channelCallbacks.addListener(channelId, event);
  }
  registerLifecycleCallback(eventName, event) {
    this._socketClient.on(eventName, event);
  }
  async makeChannel(channel) {
    if (channel in this._channels) {
      return this._channels[channel];
    }
    const channelCode = Object.keys(this._channels).length + 1;
    await this._callChannel(true, 0, '_requestChannelWithCode:identifier:', channelCode, channel);
    this._channels[channel] = channelCode;
    return channelCode;
  }
  async callChannel(channel, selector, ...auxiliaries) {
    const channelCode = await this.makeChannel(channel);
    return await this._callChannel(true, channelCode, selector, ...auxiliaries);
  }
  async _callChannel(sync, channelCode, selector, ...auxiliaries) {
    const identifier = this._nextIdentifier;
    this._encoder.write({
      sync,
      channelCode,
      selector,
      auxiliaries: auxiliaries.length === 1 && auxiliaries[0] instanceof _headers.DTXMessageAuxBuffer ? auxiliaries[0] : auxiliaries,
      identifier
    });
    ++this._nextIdentifier;
    if (sync) {
      try {
        return await (0, _asyncbox.waitForCondition)(() => {
          const queue = this._replyQueues[identifier];
          const data = queue.shift();
          if (!_lodash.default.isUndefined(data)) {
            return data;
          }
        }, {
          waitMs: WAIT_REPLY_TIME_MS,
          intervalMs: CHECK_FREQ_MS,
          error: 'reply channel data timeout'
        });
      } catch (err) {
        this.close();
        throw new Error(err);
      }
    }
  }
  _handleData(data) {
    if (_lodash.default.includes(data.selector, CHANNEL_CANCELED)) {
      this.close();
    }
    if (data.conversationIndex === 1) {
      this._replyQueues[data.identifier].push(data);
    } else if (this._channelCallbacks.listenerCount(CHANNEL_OFFSET - data.channelCode) > 0) {
      this._channelCallbacks.emit(CHANNEL_OFFSET - data.channelCode, data);
    } else {
      const selector = data.selector;
      if (_lodash.default.isString(selector) && this._callbacks.listenerCount(selector) > 0) {
        this._callbacks.emit(selector, data);
      } else if (this._undefinedCallback) {
        this._undefinedCallback(data);
      }
      if (data.expectsReply) {
        this._replyAck(data);
      }
    }
  }
  _replyAck(data) {
    const reply = new _headers.DTXMessage({
      identifier: data.identifier,
      channelCode: data.channelCode,
      conversationIndex: data.conversationIndex + 1,
      flags: _headers.FLAG_TYPES.reply
    });
    this._socketClient.write(reply.build());
  }
  dispose() {
    this._encoder.unpipe();
    this._decoder.removeAllListeners();
    this._callbacks.removeAllListeners();
    this._channelCallbacks.removeAllListeners();
    this._socketClient.removeAllListeners();
    this._socketClient.unpipe();
    this._replyQueuesRevoker();
  }
}
exports.InstrumentService = InstrumentService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYmFzZVNlcnZpY2UiLCJyZXF1aXJlIiwiX2hlYWRlcnMiLCJfZHR4RW5jb2RlIiwiX2R0eERlY29kZSIsIl9ldmVudHMiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2xvZGFzaCIsIl9hc3luY2JveCIsIkNIRUNLX0ZSRVFfTVMiLCJXQUlUX1JFUExZX1RJTUVfTVMiLCJDSEFOTkVMX0NBTkNFTEVEIiwiQ0hBTk5FTF9PRkZTRVQiLCJJTlNUUlVNRU5UX1NFUlZJQ0VfTkFNRV9WRVJTSU9OXzE0IiwiZXhwb3J0cyIsIklOU1RSVU1FTlRfU0VSVklDRV9OQU1FIiwiSU5TVFJVTUVOVF9DSEFOTkVMIiwiT2JqZWN0IiwiZnJlZXplIiwiREVWSUNFX0lORk8iLCJQUk9DRVNTX0NPTlRST0wiLCJTWVNNT05UQVAiLCJORVRXT1JLSU5HIiwiTU9CSUxFX05PVElGSUNBVElPTlMiLCJHUkFQSElDU19PUEVOR0wiLCJBUFBMSUNBVElPTl9MSVNUSU5HIiwiQ09ORElUSU9OX0lORFVDRVIiLCJkZWZhdWx0RGljdCIsImNyZWF0ZVZhbHVlIiwiUHJveHkiLCJyZXZvY2FibGUiLCJjcmVhdGUiLCJnZXQiLCJzdG9yYWdlIiwicHJvcGVydHkiLCJJbnN0cnVtZW50U2VydmljZSIsIkJhc2VTZXJ2aWNlU29ja2V0IiwiY29uc3RydWN0b3IiLCJzb2NrZXRDbGllbnQiLCJldmVudCIsIl91bmRlZmluZWRDYWxsYmFjayIsIl9jYWxsYmFja3MiLCJldmVudHMiLCJFdmVudEVtaXR0ZXIiLCJfY2hhbm5lbENhbGxiYWNrcyIsInByb3h5IiwicmV2b2tlIiwiX3JlcGx5UXVldWVzIiwiX3JlcGx5UXVldWVzUmV2b2tlciIsIl9jaGFubmVscyIsIl9uZXh0SWRlbnRpZmllciIsIl9lbmNvZGVyIiwiRFRYRW5jb2RlciIsInBpcGUiLCJfc29ja2V0Q2xpZW50IiwiX2Fzc2lnbkNsaWVudEZhaWx1cmVIYW5kbGVycyIsIl9kZWNvZGVyIiwiRFRYRGVjb2RlciIsIm9uIiwiX2hhbmRsZURhdGEiLCJiaW5kIiwicmVnaXN0ZXJTZWxlY3RvckNhbGxiYWNrIiwic2VsZWN0b3IiLCJhZGRMaXN0ZW5lciIsInJlZ2lzdGVyVW5kZWZpbmVkQ2FsbGJhY2siLCJyZWdpc3RlckNoYW5uZWxDYWxsYmFjayIsImNoYW5uZWwiLCJjaGFubmVsSWQiLCJtYWtlQ2hhbm5lbCIsInJlZ2lzdGVyTGlmZWN5Y2xlQ2FsbGJhY2siLCJldmVudE5hbWUiLCJjaGFubmVsQ29kZSIsImtleXMiLCJsZW5ndGgiLCJfY2FsbENoYW5uZWwiLCJjYWxsQ2hhbm5lbCIsImF1eGlsaWFyaWVzIiwic3luYyIsImlkZW50aWZpZXIiLCJ3cml0ZSIsIkRUWE1lc3NhZ2VBdXhCdWZmZXIiLCJ3YWl0Rm9yQ29uZGl0aW9uIiwicXVldWUiLCJkYXRhIiwic2hpZnQiLCJfIiwiaXNVbmRlZmluZWQiLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIiwiZXJyb3IiLCJlcnIiLCJjbG9zZSIsIkVycm9yIiwiaW5jbHVkZXMiLCJjb252ZXJzYXRpb25JbmRleCIsInB1c2giLCJsaXN0ZW5lckNvdW50IiwiZW1pdCIsImlzU3RyaW5nIiwiZXhwZWN0c1JlcGx5IiwiX3JlcGx5QWNrIiwicmVwbHkiLCJEVFhNZXNzYWdlIiwiZmxhZ3MiLCJGTEFHX1RZUEVTIiwiYnVpbGQiLCJkaXNwb3NlIiwidW5waXBlIiwicmVtb3ZlQWxsTGlzdGVuZXJzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2luc3RydW1lbnQvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQWRhcHRlZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9ZdWVDaGVuLUMvcHktaW9zLWRldmljZVxuXG5pbXBvcnQgeyBCYXNlU2VydmljZVNvY2tldCB9IGZyb20gJy4uL2Jhc2Utc2VydmljZSc7XG5pbXBvcnQgeyBEVFhNZXNzYWdlLCBEVFhNZXNzYWdlQXV4QnVmZmVyLCBGTEFHX1RZUEVTIH0gZnJvbSAnLi9oZWFkZXJzJztcbmltcG9ydCB7IERUWEVuY29kZXIgfSBmcm9tICcuL3RyYW5zZm9ybWVyL2R0eC1lbmNvZGUnO1xuaW1wb3J0IHsgRFRYRGVjb2RlciB9IGZyb20gJy4vdHJhbnNmb3JtZXIvZHR4LWRlY29kZSc7XG5pbXBvcnQgZXZlbnRzIGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcblxuY29uc3QgQ0hFQ0tfRlJFUV9NUyA9IDUwMDtcbmNvbnN0IFdBSVRfUkVQTFlfVElNRV9NUyA9IDEwMDAwO1xuY29uc3QgQ0hBTk5FTF9DQU5DRUxFRCA9ICdfY2hhbm5lbENhbmNlbGVkJztcbmNvbnN0IENIQU5ORUxfT0ZGU0VUID0gMiAqKiAzMjtcblxuY29uc3QgSU5TVFJVTUVOVF9TRVJWSUNFX05BTUVfVkVSU0lPTl8xNCA9ICdjb20uYXBwbGUuaW5zdHJ1bWVudHMucmVtb3Rlc2VydmVyLkRWVFNlY3VyZVNvY2tldFByb3h5JztcbmNvbnN0IElOU1RSVU1FTlRfU0VSVklDRV9OQU1FID0gJ2NvbS5hcHBsZS5pbnN0cnVtZW50cy5yZW1vdGVzZXJ2ZXInO1xuXG5leHBvcnQgY29uc3QgSU5TVFJVTUVOVF9DSEFOTkVMID0gT2JqZWN0LmZyZWV6ZSh7XG4gIERFVklDRV9JTkZPOiAnY29tLmFwcGxlLmluc3RydW1lbnRzLnNlcnZlci5zZXJ2aWNlcy5kZXZpY2VpbmZvJyxcbiAgUFJPQ0VTU19DT05UUk9MOiAnY29tLmFwcGxlLmluc3RydW1lbnRzLnNlcnZlci5zZXJ2aWNlcy5wcm9jZXNzY29udHJvbCcsXG4gIFNZU01PTlRBUDogJ2NvbS5hcHBsZS5pbnN0cnVtZW50cy5zZXJ2ZXIuc2VydmljZXMuc3lzbW9udGFwJyxcbiAgTkVUV09SS0lORzogJ2NvbS5hcHBsZS5pbnN0cnVtZW50cy5zZXJ2ZXIuc2VydmljZXMubmV0d29ya2luZycsXG4gIE1PQklMRV9OT1RJRklDQVRJT05TOiAnY29tLmFwcGxlLmluc3RydW1lbnRzLnNlcnZlci5zZXJ2aWNlcy5tb2JpbGVub3RpZmljYXRpb25zJyxcbiAgR1JBUEhJQ1NfT1BFTkdMOiAnY29tLmFwcGxlLmluc3RydW1lbnRzLnNlcnZlci5zZXJ2aWNlcy5ncmFwaGljcy5vcGVuZ2wnLFxuICBBUFBMSUNBVElPTl9MSVNUSU5HOiAnY29tLmFwcGxlLmluc3RydW1lbnRzLnNlcnZlci5zZXJ2aWNlcy5kZXZpY2UuYXBwbGljdGlvbkxpc3RpbmcnLFxuICBDT05ESVRJT05fSU5EVUNFUjogJ2NvbS5hcHBsZS5pbnN0cnVtZW50cy5zZXJ2ZXIuc2VydmljZXMuQ29uZGl0aW9uSW5kdWNlcidcbn0pO1xuXG5mdW5jdGlvbiBkZWZhdWx0RGljdChjcmVhdGVWYWx1ZSkge1xuICByZXR1cm4gUHJveHkucmV2b2NhYmxlKE9iamVjdC5jcmVhdGUobnVsbCksIHtcbiAgICBnZXQoc3RvcmFnZSwgcHJvcGVydHkpIHtcbiAgICAgIGlmICghKHByb3BlcnR5IGluIHN0b3JhZ2UpKSB7XG4gICAgICAgIHN0b3JhZ2VbcHJvcGVydHldID0gY3JlYXRlVmFsdWUocHJvcGVydHkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0b3JhZ2VbcHJvcGVydHldO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKiBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggd2lsbCBiZSBjYWxsZWQgZHVyaW5nIHRoZSBkYXRhIHRyYW5zbWlzc2lvbiBpbiBpbnN0cnVtZW50IHNlcnZlXG4gKiBAY2FsbGJhY2sgRFRYQ2FsbGJhY2tcbiAqIEBwYXJhbSB7RFRYTWVzc2FnZX0gb2JqZWN0XG4qL1xuXG5jbGFzcyBJbnN0cnVtZW50U2VydmljZSBleHRlbmRzIEJhc2VTZXJ2aWNlU29ja2V0IHtcbiAgLyoqXG4gICAqIEBwYXJhbSB7aW1wb3J0KCduZXQnKS5Tb2NrZXR9IHNvY2tldENsaWVudCAgRFRYTWVzc2FnZS5zZWxlY3RvclxuICAgKiBAcGFyYW0ge0RUWENhbGxiYWNrP30gZXZlbnQgaWYgZW1wdHkgd2lsbCBpZ25vcmUgYW55IG1lc3NhZ2VzXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihzb2NrZXRDbGllbnQsIGV2ZW50KSB7XG4gICAgc3VwZXIoc29ja2V0Q2xpZW50KTtcbiAgICB0aGlzLl91bmRlZmluZWRDYWxsYmFjayA9IGV2ZW50O1xuICAgIHRoaXMuX2NhbGxiYWNrcyA9IG5ldyBldmVudHMuRXZlbnRFbWl0dGVyKCk7XG4gICAgdGhpcy5fY2hhbm5lbENhbGxiYWNrcyA9IG5ldyBldmVudHMuRXZlbnRFbWl0dGVyKCk7XG4gICAgY29uc3QgeyBwcm94eSwgcmV2b2tlIH0gPSBkZWZhdWx0RGljdCgoKSA9PiBbXSk7XG4gICAgdGhpcy5fcmVwbHlRdWV1ZXMgPSBwcm94eTtcbiAgICB0aGlzLl9yZXBseVF1ZXVlc1Jldm9rZXIgPSByZXZva2U7XG4gICAgdGhpcy5fY2hhbm5lbHMgPSB7fTtcbiAgICB0aGlzLl9uZXh0SWRlbnRpZmllciA9IDE7XG4gICAgdGhpcy5fZW5jb2RlciA9IG5ldyBEVFhFbmNvZGVyKCk7XG4gICAgdGhpcy5fZW5jb2Rlci5waXBlKHRoaXMuX3NvY2tldENsaWVudCk7XG4gICAgdGhpcy5fYXNzaWduQ2xpZW50RmFpbHVyZUhhbmRsZXJzKHRoaXMuX2VuY29kZXIpO1xuICAgIHRoaXMuX2RlY29kZXIgPSBuZXcgRFRYRGVjb2RlcigpO1xuICAgIHRoaXMuX3NvY2tldENsaWVudC5waXBlKHRoaXMuX2RlY29kZXIpO1xuICAgIHRoaXMuX2RlY29kZXIub24oJ2RhdGEnLCB0aGlzLl9oYW5kbGVEYXRhLmJpbmQodGhpcykpO1xuICB9XG5cbiAgLyoqXG4gICAqIElmIHRoZSBzZWxlY3RvciBpcyByZWdpc3RlcmVkLCBUaGUgbWVzc2FnZSBvZiB0aGUgc2VsZWN0b3IgZXZlbnQgd2lsbCBiZSByZXR1cm5lZC4gcmVmZXIgdG8gdGhpcy5faGFuZGxlRGF0YVxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3IgIExpc3RlbiBmb3IgcmV0dXJuIERUWE1lc3NhZ2Uuc2VsZWN0b3IgZGF0YVxuICAgKiBAcGFyYW0ge0RUWENhbGxiYWNrfSBldmVudFxuICAgKi9cbiAgcmVnaXN0ZXJTZWxlY3RvckNhbGxiYWNrKHNlbGVjdG9yLCBldmVudCkge1xuICAgIHRoaXMuX2NhbGxiYWNrcy5hZGRMaXN0ZW5lcihzZWxlY3RvciwgZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIElmIHRoZSBldmVudCBpcyByZWdpc3RlcmVkLCBhbGwgdW5yZWdpc3RlcmVkIG1lc3NhZ2VzIHdpbGwgYmUgcmV0dXJuZWQgdG8gZXZlbnQuIHJlZmVyIHRvIHRoaXMuX2hhbmRsZURhdGFcbiAgICogQHBhcmFtIHtEVFhDYWxsYmFja30gZXZlbnRcbiAgICovXG4gIHJlZ2lzdGVyVW5kZWZpbmVkQ2FsbGJhY2soZXZlbnQpIHtcbiAgICB0aGlzLl91bmRlZmluZWRDYWxsYmFjayA9IGV2ZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIElmIHRoZSBldmVudCBpcyByZWdpc3RlcmVkLCB0aGlzIGNoYW5uZWwge0NIQU5ORUx9IG1lc3NhZ2VzIHdpbGwgYmUgcmV0dXJuZWQgdG8gZXZlbnQuIHJlZmVyIHRvIHRoaXMuX2hhbmRsZURhdGFcbiAgICogSXQncyBhY3R1YWxseSBsaXN0ZW5pbmcgZm9yIGludCBjaGFubmVsQ29kZS4gSW4gdGhpcy5fY2hhbm5lbCBvYmplY3QgdG8gcmVjb3JkIGNoYW5uZWwga2V5IGFuZCBpbnQgdmFsdWVcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNoYW5uZWwgaW5zdHJ1bWVudHMgc2VydmljZSBjaGFubmVsIGUuZzogSU5TVFJVTUVOVF9DSEFOTkVMLkRFVklDRV9JTkZPLlxuICAgKiBAcGFyYW0ge0RUWENhbGxiYWNrfSBldmVudFxuICAgKi9cbiAgYXN5bmMgcmVnaXN0ZXJDaGFubmVsQ2FsbGJhY2soY2hhbm5lbCwgZXZlbnQpIHtcbiAgICBjb25zdCBjaGFubmVsSWQgPSBhd2FpdCB0aGlzLm1ha2VDaGFubmVsKGNoYW5uZWwpO1xuICAgIHRoaXMuX2NoYW5uZWxDYWxsYmFja3MuYWRkTGlzdGVuZXIoY2hhbm5lbElkLCBldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogRXZlbnQgd2lsbCBiZSByZWdpc3RlcmVkIHRvIHNvY2tldCBjbGllbnQgbGlmZWN5Y2xlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudE5hbWVcbiAgICogQHBhcmFtIHsobWVzc2FnZTogYW55IHwgbnVsbCkgPT4gdm9pZH0gZXZlbnRcbiAgICovXG4gIHJlZ2lzdGVyTGlmZWN5Y2xlQ2FsbGJhY2soZXZlbnROYW1lLCBldmVudCkge1xuICAgIHRoaXMuX3NvY2tldENsaWVudC5vbihldmVudE5hbWUsIGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBzZXJ2aWNlIGNoYW5uZWwsIGRhdGEgdHJhbnNtaXNzaW9uIG9mIHRoZSBzZXJ2aWNlIHdpbGwgdXNlIHRoaXMgY2hhbm5lbENvZGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNoYW5uZWwgIGluc3RydW1lbnRzIHNlcnZpY2UgY2hhbm5lbCBlLmc6IElOU1RSVU1FTlRfQ0hBTk5FTC5ERVZJQ0VfSU5GT1xuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxudW1iZXJ8Kj59IGluc3RydW1lbnRzIHNlcnZpY2UgY2hhbm5lbCBjb2RlIGZvciBkYXRhIHRyYW5zbWlzc2lvblxuICAgKi9cbiAgYXN5bmMgbWFrZUNoYW5uZWwoY2hhbm5lbCkge1xuICAgIGlmIChjaGFubmVsIGluIHRoaXMuX2NoYW5uZWxzKSB7XG4gICAgICByZXR1cm4gdGhpcy5fY2hhbm5lbHNbY2hhbm5lbF07XG4gICAgfVxuICAgIGNvbnN0IGNoYW5uZWxDb2RlID0gT2JqZWN0LmtleXModGhpcy5fY2hhbm5lbHMpLmxlbmd0aCArIDE7XG4gICAgYXdhaXQgdGhpcy5fY2FsbENoYW5uZWwodHJ1ZSwgMCwgJ19yZXF1ZXN0Q2hhbm5lbFdpdGhDb2RlOmlkZW50aWZpZXI6JywgY2hhbm5lbENvZGUsIGNoYW5uZWwpO1xuICAgIHRoaXMuX2NoYW5uZWxzW2NoYW5uZWxdID0gY2hhbm5lbENvZGU7XG4gICAgcmV0dXJuIGNoYW5uZWxDb2RlO1xuICB9XG5cbiAgLyoqXG4gICAqIEluIGdlbmVyYWwsIHdlIGNhbGwgdGhpcyBtZXRob2QgdG8gc3RhcnQgdGhlIGluc3RydW1lbnQgZHR4IHNlcnZpY2VcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNoYW5uZWwgaW5zdHJ1bWVudCBkdHggc2VydmljZSBlLmc6IElOU1RSVU1FTlRfQ0hBTk5FTC5ERVZJQ0VfSU5GT1xuICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3IgaW5zdHJ1bWVudCBzZXJ2aWNlIG1ldGhvZCBuYW1lIChyZWZsZWN0aW9uIGNhbGxzKVxuICAgKiBAcGFyYW0gey4uLmFueSB8IERUWE1lc3NhZ2VBdXhCdWZmZXJ9IGF1eGlsaWFyaWVzIHBhcmFtZXRlcnMgcmVxdWlyZWQgYnkgc2VsZWN0b3IuIElmIGF1eGlsaWFyaWVzIGFyZSBwYXNzZWQgaW4gdXNpbmdcbiAgICogdGhlIERUWE1lc3NhZ2VBdXhCdWZmZXIgdHlwZSwgYWxsIHRoZSB2YXJpYWJsZXMgc2hvdWxkIGJlIG1hbnVhbGx5IGFzc2VtYmxlZCBpbnRvIG9ubHkgb25lIERUWE1lc3NhZ2VBdXhCdWZmZXIgaW5zdGFuY2UuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPERUWE1lc3NhZ2U+fVxuICAgKiBleGFtcGxl77yaXG4gICAqIGluc3RydW1lbnRTZXJ2aWNlLmNhbGxDaGFubmVsKElOU1RSVU1FTlRfQ0hBTk5FTC5QUk9DRVNTX0NPTlRST0wsXG4gICAgICAgICdsYXVuY2hTdXNwZW5kZWRQcm9jZXNzV2l0aERldmljZVBhdGg6YnVuZGxlSWRlbnRpZmllcjplbnZpcm9ubWVudDphcmd1bWVudHM6b3B0aW9uczonLCAnJyxcbiAgICAgICAgYnVuZGxlSUQsIHt9LCBbXSwgeydTdGFydFN1c3BlbmRlZEtleSc6IDAsICdLaWxsRXhpc3RpbmcnOiAxfVxuICAgKi9cbiAgYXN5bmMgY2FsbENoYW5uZWwoY2hhbm5lbCwgc2VsZWN0b3IsIC4uLmF1eGlsaWFyaWVzKSB7XG4gICAgY29uc3QgY2hhbm5lbENvZGUgPSBhd2FpdCB0aGlzLm1ha2VDaGFubmVsKGNoYW5uZWwpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLl9jYWxsQ2hhbm5lbCh0cnVlLCBjaGFubmVsQ29kZSwgc2VsZWN0b3IsIC4uLmF1eGlsaWFyaWVzKTtcbiAgfVxuXG4gIGFzeW5jIF9jYWxsQ2hhbm5lbChzeW5jLCBjaGFubmVsQ29kZSwgc2VsZWN0b3IsIC4uLmF1eGlsaWFyaWVzKSB7XG4gICAgY29uc3QgaWRlbnRpZmllciA9IHRoaXMuX25leHRJZGVudGlmaWVyO1xuICAgIHRoaXMuX2VuY29kZXIud3JpdGUoe1xuICAgICAgc3luYyxcbiAgICAgIGNoYW5uZWxDb2RlLFxuICAgICAgc2VsZWN0b3IsXG4gICAgICBhdXhpbGlhcmllczogKGF1eGlsaWFyaWVzLmxlbmd0aCA9PT0gMSAmJiBhdXhpbGlhcmllc1swXSBpbnN0YW5jZW9mIERUWE1lc3NhZ2VBdXhCdWZmZXIpID8gYXV4aWxpYXJpZXNbMF0gOiBhdXhpbGlhcmllcyxcbiAgICAgIGlkZW50aWZpZXJcbiAgICB9KTtcbiAgICArK3RoaXMuX25leHRJZGVudGlmaWVyO1xuICAgIGlmIChzeW5jKSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gYXdhaXQgd2FpdEZvckNvbmRpdGlvbigoKSA9PiB7XG4gICAgICAgICAgY29uc3QgcXVldWUgPSB0aGlzLl9yZXBseVF1ZXVlc1tpZGVudGlmaWVyXTtcbiAgICAgICAgICBjb25zdCBkYXRhID0gcXVldWUuc2hpZnQoKTtcbiAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoZGF0YSkpIHtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgeyB3YWl0TXM6IFdBSVRfUkVQTFlfVElNRV9NUywgaW50ZXJ2YWxNczogQ0hFQ0tfRlJFUV9NUywgZXJyb3I6ICdyZXBseSBjaGFubmVsIGRhdGEgdGltZW91dCcgfSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxpbmcgcmVnaXN0ZXJlZCBhc3luY2hyb25vdXMgbWVzc2FnZSBjYWxsYmFja3NcbiAgICogQHBhcmFtIHtEVFhNZXNzYWdlfSBkYXRhXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfaGFuZGxlRGF0YShkYXRhKSB7XG4gICAgaWYgKF8uaW5jbHVkZXMoZGF0YS5zZWxlY3RvciwgQ0hBTk5FTF9DQU5DRUxFRCkpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gICAgaWYgKGRhdGEuY29udmVyc2F0aW9uSW5kZXggPT09IDEpIHtcbiAgICAgIHRoaXMuX3JlcGx5UXVldWVzW2RhdGEuaWRlbnRpZmllcl0ucHVzaChkYXRhKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuX2NoYW5uZWxDYWxsYmFja3MubGlzdGVuZXJDb3VudChDSEFOTkVMX09GRlNFVCAtIGRhdGEuY2hhbm5lbENvZGUpID4gMCkge1xuICAgICAgdGhpcy5fY2hhbm5lbENhbGxiYWNrcy5lbWl0KENIQU5ORUxfT0ZGU0VUIC0gZGF0YS5jaGFubmVsQ29kZSwgZGF0YSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHNlbGVjdG9yID0gZGF0YS5zZWxlY3RvcjtcbiAgICAgIGlmIChfLmlzU3RyaW5nKHNlbGVjdG9yKSAmJiB0aGlzLl9jYWxsYmFja3MubGlzdGVuZXJDb3VudChzZWxlY3RvcikgPiAwKSB7XG4gICAgICAgIHRoaXMuX2NhbGxiYWNrcy5lbWl0KHNlbGVjdG9yLCBkYXRhKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5fdW5kZWZpbmVkQ2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fdW5kZWZpbmVkQ2FsbGJhY2soZGF0YSk7XG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5leHBlY3RzUmVwbHkpIHtcbiAgICAgICAgdGhpcy5fcmVwbHlBY2soZGF0YSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIHJldHVybiBhIGVtcHR5IGFjayBtZXNzYWdlXG4gICAqIEBwYXJhbSB7RFRYTWVzc2FnZX0gZGF0YVxuICAgKi9cbiAgX3JlcGx5QWNrKGRhdGEpIHtcbiAgICBjb25zdCByZXBseSA9IG5ldyBEVFhNZXNzYWdlKHtcbiAgICAgIGlkZW50aWZpZXI6IGRhdGEuaWRlbnRpZmllcixcbiAgICAgIGNoYW5uZWxDb2RlOiBkYXRhLmNoYW5uZWxDb2RlLFxuICAgICAgY29udmVyc2F0aW9uSW5kZXg6IGRhdGEuY29udmVyc2F0aW9uSW5kZXggKyAxLFxuICAgICAgZmxhZ3M6IEZMQUdfVFlQRVMucmVwbHlcbiAgICB9KTtcbiAgICB0aGlzLl9zb2NrZXRDbGllbnQud3JpdGUocmVwbHkuYnVpbGQoKSk7XG4gIH1cblxuICBkaXNwb3NlKCkge1xuICAgIHRoaXMuX2VuY29kZXIudW5waXBlKCk7XG4gICAgdGhpcy5fZGVjb2Rlci5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9jYWxsYmFja3MucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fY2hhbm5lbENhbGxiYWNrcy5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9zb2NrZXRDbGllbnQucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fc29ja2V0Q2xpZW50LnVucGlwZSgpO1xuICAgIHRoaXMuX3JlcGx5UXVldWVzUmV2b2tlcigpO1xuICB9XG59XG5cbmV4cG9ydCB7IEluc3RydW1lbnRTZXJ2aWNlLCBJTlNUUlVNRU5UX1NFUlZJQ0VfTkFNRV9WRVJTSU9OXzE0LCBJTlNUUlVNRU5UX1NFUlZJQ0VfTkFNRSB9O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUVBLElBQUFBLFlBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLFFBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLFVBQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLFVBQUEsR0FB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