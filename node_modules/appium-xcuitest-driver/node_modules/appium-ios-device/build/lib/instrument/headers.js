"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.FLAG_TYPES = exports.DTX_MESSAGE_PAYLOAD_HEADER_LENGTH = exports.DTX_MESSAGE_HEADER_MAGIC_LEN = exports.DTX_MESSAGE_HEADER_MAGIC = exports.DTX_MESSAGE_HEADER_LENGTH = exports.DTXMessagePayloadHeader = exports.DTXMessageHeader = exports.DTXMessageAuxBuffer = exports.DTXMessageAux = exports.DTXMessage = void 0;
require("source-map-support/register");
var _nskeyed = require("./transformer/nskeyed");
var _bplistParser = _interopRequireDefault(require("bplist-parser"));
var _lodash = _interopRequireDefault(require("lodash"));
const DTX_MESSAGE_PAYLOAD_HEADER_LENGTH = 16;
exports.DTX_MESSAGE_PAYLOAD_HEADER_LENGTH = DTX_MESSAGE_PAYLOAD_HEADER_LENGTH;
const DTX_MESSAGE_HEADER_LENGTH = 32;
exports.DTX_MESSAGE_HEADER_LENGTH = DTX_MESSAGE_HEADER_LENGTH;
const DTX_MESSAGE_HEADER_MAGIC = 0x1F3D5B79;
exports.DTX_MESSAGE_HEADER_MAGIC = DTX_MESSAGE_HEADER_MAGIC;
const DTX_MESSAGE_HEADER_MAGIC_LEN = 4;
exports.DTX_MESSAGE_HEADER_MAGIC_LEN = DTX_MESSAGE_HEADER_MAGIC_LEN;
const DTX_MESSAGE_AUX_HEADER = 0x01F0;
const DTX_AUXILIARY_MAGIC = 0xa;
const FLAG_TYPES = Object.freeze({
  push: 0,
  recv: 1,
  send: 2,
  reply: 3
});
exports.FLAG_TYPES = FLAG_TYPES;
const AUX_TYPES = Object.freeze({
  Text: 1,
  NSKeyed: 2,
  UInt32LE: 3,
  BigUInt64LE: 4,
  BigInt64LE: 6
});
class DTXMessageHeader {
  static build(data) {
    const messageHeader = Buffer.alloc(DTX_MESSAGE_HEADER_LENGTH);
    messageHeader.writeUInt32LE(DTX_MESSAGE_HEADER_MAGIC, 0);
    messageHeader.writeUInt32LE(DTX_MESSAGE_HEADER_LENGTH, 4);
    messageHeader.writeUInt16LE(0, 8);
    messageHeader.writeUInt16LE(1, 10);
    messageHeader.writeUInt32LE(data.payloadLength, 12);
    messageHeader.writeUInt32LE(data.identifier, 16);
    messageHeader.writeUInt32LE(data.conversationIndex, 20);
    messageHeader.writeUInt32LE(data.channelCode, 24);
    messageHeader.writeUInt32LE(data.expectsReply, 28);
    return messageHeader;
  }
  static parse(headerBuffer) {
    return {
      magic: headerBuffer.readUInt32LE(0),
      headerLength: headerBuffer.readUInt32LE(4),
      fragmentId: headerBuffer.readUInt16LE(8),
      fragmentCount: headerBuffer.readUInt16LE(10),
      payloadLength: headerBuffer.readUInt32LE(12),
      identifier: headerBuffer.readUInt32LE(16),
      conversationIndex: headerBuffer.readUInt32LE(20),
      channel: headerBuffer.readUInt32LE(24),
      expectsReply: headerBuffer.readUInt32LE(28)
    };
  }
}
exports.DTXMessageHeader = DTXMessageHeader;
class DTXMessagePayloadHeader {
  static build(data) {
    const messageHeader = Buffer.alloc(DTX_MESSAGE_PAYLOAD_HEADER_LENGTH);
    messageHeader.writeUInt32LE(data.flags, 0);
    messageHeader.writeUInt32LE(data.auxLength, 4);
    messageHeader.writeBigUInt64LE(data.totalLength, 8);
    return messageHeader;
  }
  static parse(headerBuffer) {
    return {
      flags: headerBuffer.readUInt32LE(0),
      auxLength: headerBuffer.readUInt32LE(4),
      totalLength: headerBuffer.readBigInt64LE(8)
    };
  }
}
exports.DTXMessagePayloadHeader = DTXMessagePayloadHeader;
class DTXMessageAux {
  constructor(data = []) {
    this.data = data;
  }
  build() {
    if (this.data instanceof DTXMessageAuxBuffer) {
      return this.data.getBytes();
    }
    const messageAux = new DTXMessageAuxBuffer();
    let buf = Buffer.alloc(0);
    for (const arg of this.data) {
      if (arg instanceof DTXMessageAuxBuffer) {
        buf = Buffer.concat([buf, arg.getBytes()]);
      } else if (_lodash.default.isNumber(arg)) {
        messageAux.appendInt(arg);
      } else if (typeof arg == 'bigint') {
        messageAux.appendLong(arg);
      } else {
        messageAux.appendObject(arg);
      }
    }
    return Buffer.concat([buf, messageAux.getBytes()]);
  }
  static parse(headerBuffer, payloadHeader) {
    let cursor = 0;
    const data = [];
    const length = headerBuffer.readBigInt64LE(8);
    cursor += 16;
    while (cursor <= length) {
      if (payloadHeader.flags !== FLAG_TYPES.push) {
        const m = headerBuffer.readUInt32LE(cursor);
        cursor += 4;
        if (m !== DTX_AUXILIARY_MAGIC) {
          throw new Error(`incorrect auxiliary magic: ${m}`);
        }
      }
      const type = headerBuffer.readUInt32LE(cursor);
      cursor += 4;
      switch (type) {
        case AUX_TYPES.Text:
          {
            const strLen = headerBuffer.readUInt32LE(cursor);
            cursor += 4;
            data.push(headerBuffer.slice(cursor, cursor + strLen));
            cursor += strLen;
            break;
          }
        case AUX_TYPES.NSKeyed:
          {
            const strLen = headerBuffer.readUInt32LE(cursor);
            cursor += 4;
            const archived_data = headerBuffer.slice(cursor, cursor + strLen);
            data.push((0, _nskeyed.unarchive)(archived_data));
            cursor += strLen;
            break;
          }
        case AUX_TYPES.UInt32LE:
          data.push(headerBuffer.readUInt32LE(cursor));
          cursor += 4;
          break;
        case AUX_TYPES.BigUInt64LE:
          data.push(headerBuffer.readBigUInt64LE(cursor));
          cursor += 8;
          break;
        case AUX_TYPES.BigInt64LE:
          data.push(headerBuffer.readBigInt64LE(cursor));
          cursor += 8;
          break;
        default:
          throw new Error(`Unknown type ${type}`);
      }
    }
    return data;
  }
}
exports.DTXMessageAux = DTXMessageAux;
class InstrumentRPCParseError {
  constructor(data) {
    this.data = data;
  }
}
class DTXMessageAuxBuffer {
  constructor() {
    this._buf = Buffer.alloc(0);
  }
  appendInt(value) {
    const buf = Buffer.alloc(12);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(3, 4);
    buf.writeUInt32LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }
  appendLong(value) {
    const buf = Buffer.alloc(16);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(4, 4);
    buf.writeBigUInt64LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }
  appendSignedInt(value) {
    const buf = Buffer.alloc(12);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(3, 4);
    buf.writeInt32LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }
  appendSignedLong(value) {
    const buf = Buffer.alloc(16);
    buf.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf.writeUInt32LE(6, 4);
    buf.writeBigInt64LE(value, 8);
    this._buf = Buffer.concat([this._buf, buf]);
  }
  appendObject(value) {
    const buf = (0, _nskeyed.archive)(value);
    const buf2 = Buffer.alloc(12);
    buf2.writeUInt32LE(DTX_AUXILIARY_MAGIC, 0);
    buf2.writeUInt32LE(2, 4);
    buf2.writeUInt32LE(buf.length, 8);
    this._buf = Buffer.concat([this._buf, buf2, buf]);
  }
  getBytes() {
    const out = Buffer.alloc(16);
    out.writeUInt32LE(DTX_MESSAGE_AUX_HEADER, 0);
    out.writeUInt32LE(this._buf.length, 8);
    return Buffer.concat([out, this._buf]);
  }
}
exports.DTXMessageAuxBuffer = DTXMessageAuxBuffer;
class DTXMessage {
  constructor(opts = {}) {
    const {
      identifier,
      channelCode,
      selector,
      expectsReply,
      conversationIndex = 0,
      flags = FLAG_TYPES.send
    } = opts;
    this._messageHeader = undefined;
    this._payloadHeader = undefined;
    this._identifier = identifier;
    this._channelCode = channelCode;
    this._expectsReply = expectsReply;
    this._selector = selector;
    this._conversationIndex = conversationIndex;
    this._flags = flags;
    this.auxiliaries = new DTXMessageAux();
  }
  get identifier() {
    var _this$_messageHeader;
    return (_this$_messageHeader = this._messageHeader) === null || _this$_messageHeader === void 0 ? void 0 : _this$_messageHeader.identifier;
  }
  get channelCode() {
    var _this$_messageHeader2;
    return (_this$_messageHeader2 = this._messageHeader) === null || _this$_messageHeader2 === void 0 ? void 0 : _this$_messageHeader2.channel;
  }
  get expectsReply() {
    var _this$_messageHeader3;
    return (_this$_messageHeader3 = this._messageHeader) === null || _this$_messageHeader3 === void 0 ? void 0 : _this$_messageHeader3.expectsReply;
  }
  get selector() {
    return this._selector;
  }
  set selector(data) {
    this._selector = data;
  }
  get conversationIndex() {
    var _this$_messageHeader4;
    return (_this$_messageHeader4 = this._messageHeader) === null || _this$_messageHeader4 === void 0 ? void 0 : _this$_messageHeader4.conversationIndex;
  }
  build() {
    const sel = this._selector ? (0, _nskeyed.archive)(this._selector) : Buffer.alloc(0);
    const aux = this.auxiliaries.build();
    const payloadHeader = DTXMessagePayloadHeader.build({
      flags: this._flags,
      auxLength: aux.length,
      totalLength: BigInt(aux.length + sel.length)
    });
    const messageHeader = DTXMessageHeader.build({
      payloadLength: DTX_MESSAGE_PAYLOAD_HEADER_LENGTH + aux.length + sel.length,
      identifier: this._identifier,
      conversationIndex: this._conversationIndex,
      channelCode: this._channelCode,
      expectsReply: this._expectsReply
    });
    return Buffer.concat([messageHeader, payloadHeader, aux, sel]);
  }
  static parse(headerBuf, payloadBuf) {
    let cursor = 0;
    const ret = new DTXMessage();
    ret._messageHeader = DTXMessageHeader.parse(headerBuf);
    if (ret._messageHeader.payloadLength === 0) {
      return ret;
    }
    ret._payloadHeader = DTXMessagePayloadHeader.parse(payloadBuf.slice(cursor, DTX_MESSAGE_PAYLOAD_HEADER_LENGTH));
    cursor += DTX_MESSAGE_PAYLOAD_HEADER_LENGTH;
    if (ret._payloadHeader.totalLength === 0n) {
      return ret;
    }
    if (ret._payloadHeader.auxLength > 0) {
      ret.auxiliaries = DTXMessageAux.parse(payloadBuf.slice(cursor, cursor + ret._payloadHeader.auxLength), ret._payloadHeader);
      cursor += ret._payloadHeader.auxLength;
    }
    const data = payloadBuf.slice(cursor, cursor + payloadBuf.length);
    ret.selector = data;
    if (data.length > 0) {
      for (const fun of [_nskeyed.unarchive, _bplistParser.default.parseBuffer]) {
        try {
          ret.selector = fun(data);
          break;
        } catch (e) {
          ret.selector = new InstrumentRPCParseError(data);
        }
      }
    }
    return ret;
  }
}
exports.DTXMessage = DTXMessage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbnNrZXllZCIsInJlcXVpcmUiLCJfYnBsaXN0UGFyc2VyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9sb2Rhc2giLCJEVFhfTUVTU0FHRV9QQVlMT0FEX0hFQURFUl9MRU5HVEgiLCJleHBvcnRzIiwiRFRYX01FU1NBR0VfSEVBREVSX0xFTkdUSCIsIkRUWF9NRVNTQUdFX0hFQURFUl9NQUdJQyIsIkRUWF9NRVNTQUdFX0hFQURFUl9NQUdJQ19MRU4iLCJEVFhfTUVTU0FHRV9BVVhfSEVBREVSIiwiRFRYX0FVWElMSUFSWV9NQUdJQyIsIkZMQUdfVFlQRVMiLCJPYmplY3QiLCJmcmVlemUiLCJwdXNoIiwicmVjdiIsInNlbmQiLCJyZXBseSIsIkFVWF9UWVBFUyIsIlRleHQiLCJOU0tleWVkIiwiVUludDMyTEUiLCJCaWdVSW50NjRMRSIsIkJpZ0ludDY0TEUiLCJEVFhNZXNzYWdlSGVhZGVyIiwiYnVpbGQiLCJkYXRhIiwibWVzc2FnZUhlYWRlciIsIkJ1ZmZlciIsImFsbG9jIiwid3JpdGVVSW50MzJMRSIsIndyaXRlVUludDE2TEUiLCJwYXlsb2FkTGVuZ3RoIiwiaWRlbnRpZmllciIsImNvbnZlcnNhdGlvbkluZGV4IiwiY2hhbm5lbENvZGUiLCJleHBlY3RzUmVwbHkiLCJwYXJzZSIsImhlYWRlckJ1ZmZlciIsIm1hZ2ljIiwicmVhZFVJbnQzMkxFIiwiaGVhZGVyTGVuZ3RoIiwiZnJhZ21lbnRJZCIsInJlYWRVSW50MTZMRSIsImZyYWdtZW50Q291bnQiLCJjaGFubmVsIiwiRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIiLCJmbGFncyIsImF1eExlbmd0aCIsIndyaXRlQmlnVUludDY0TEUiLCJ0b3RhbExlbmd0aCIsInJlYWRCaWdJbnQ2NExFIiwiRFRYTWVzc2FnZUF1eCIsImNvbnN0cnVjdG9yIiwiRFRYTWVzc2FnZUF1eEJ1ZmZlciIsImdldEJ5dGVzIiwibWVzc2FnZUF1eCIsImJ1ZiIsImFyZyIsImNvbmNhdCIsIl8iLCJpc051bWJlciIsImFwcGVuZEludCIsImFwcGVuZExvbmciLCJhcHBlbmRPYmplY3QiLCJwYXlsb2FkSGVhZGVyIiwiY3Vyc29yIiwibGVuZ3RoIiwibSIsIkVycm9yIiwidHlwZSIsInN0ckxlbiIsInNsaWNlIiwiYXJjaGl2ZWRfZGF0YSIsInVuYXJjaGl2ZSIsInJlYWRCaWdVSW50NjRMRSIsIkluc3RydW1lbnRSUENQYXJzZUVycm9yIiwiX2J1ZiIsInZhbHVlIiwiYXBwZW5kU2lnbmVkSW50Iiwid3JpdGVJbnQzMkxFIiwiYXBwZW5kU2lnbmVkTG9uZyIsIndyaXRlQmlnSW50NjRMRSIsImFyY2hpdmUiLCJidWYyIiwib3V0IiwiRFRYTWVzc2FnZSIsIm9wdHMiLCJzZWxlY3RvciIsIl9tZXNzYWdlSGVhZGVyIiwidW5kZWZpbmVkIiwiX3BheWxvYWRIZWFkZXIiLCJfaWRlbnRpZmllciIsIl9jaGFubmVsQ29kZSIsIl9leHBlY3RzUmVwbHkiLCJfc2VsZWN0b3IiLCJfY29udmVyc2F0aW9uSW5kZXgiLCJfZmxhZ3MiLCJhdXhpbGlhcmllcyIsIl90aGlzJF9tZXNzYWdlSGVhZGVyIiwiX3RoaXMkX21lc3NhZ2VIZWFkZXIyIiwiX3RoaXMkX21lc3NhZ2VIZWFkZXIzIiwiX3RoaXMkX21lc3NhZ2VIZWFkZXI0Iiwic2VsIiwiYXV4IiwiQmlnSW50IiwiaGVhZGVyQnVmIiwicGF5bG9hZEJ1ZiIsInJldCIsImZ1biIsInBsaXN0bGliIiwicGFyc2VCdWZmZXIiLCJlIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2luc3RydW1lbnQvaGVhZGVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2FyY2hpdmUsIHVuYXJjaGl2ZX0gZnJvbSAnLi90cmFuc2Zvcm1lci9uc2tleWVkJztcbmltcG9ydCBwbGlzdGxpYiBmcm9tICdicGxpc3QtcGFyc2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmNvbnN0IERUWF9NRVNTQUdFX1BBWUxPQURfSEVBREVSX0xFTkdUSCA9IDE2O1xuY29uc3QgRFRYX01FU1NBR0VfSEVBREVSX0xFTkdUSCA9IDMyO1xuY29uc3QgRFRYX01FU1NBR0VfSEVBREVSX01BR0lDID0gMHgxRjNENUI3OTtcbmNvbnN0IERUWF9NRVNTQUdFX0hFQURFUl9NQUdJQ19MRU4gPSA0O1xuY29uc3QgRFRYX01FU1NBR0VfQVVYX0hFQURFUiA9IDB4MDFGMDtcbmNvbnN0IERUWF9BVVhJTElBUllfTUFHSUMgPSAweGE7XG5cbmNvbnN0IEZMQUdfVFlQRVMgPSBPYmplY3QuZnJlZXplKHtcbiAgcHVzaDogMCxcbiAgcmVjdjogMSxcbiAgc2VuZDogMixcbiAgcmVwbHk6IDNcbn0pO1xuXG5jb25zdCBBVVhfVFlQRVMgPSBPYmplY3QuZnJlZXplKHtcbiAgVGV4dDogMSxcbiAgTlNLZXllZDogMixcbiAgVUludDMyTEU6IDMsXG4gIEJpZ1VJbnQ2NExFOiA0LFxuICBCaWdJbnQ2NExFOiA2XG59KTtcblxuLyoqXG4gKiBEVFhNZXNzYWdlSGVhZGVyIGxlbmd0aCAzMlxuICogc3RydWN0IERUWE1lc3NhZ2VIZWFkZXIge1xuICogICAgIHUzMiBtYWdpYyBEVFhfTUVTU0FHRV9IRUFERVJfTUFHSUNcbiAqICAgICB1MzIgaGVhZGVyTGVuZ3RoXG4gKiAgICAgdTE2IGZyYWdtZW50SWQgICBwYWNrZXQgbnVtYmVyXG4gKiAgICAgdTE2IGZyYWdtZW50Q291bnQgIHBhY2tldHMgdG90YWwgbnVtYmVyXG4gKiAgICAgdTMyIHBheWxvYWRMZW5ndGhcbiAqICAgICB1MzIgaWRlbnRpZmllclxuICogICAgIHUzMiBjb252ZXJzYXRpb25JbmRleFxuICogICAgIHUzMiBjaGFubmVsXG4gKiAgICAgdTMyIGV4cGVjdHNSZXBseVxuICogICAgIH1cbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IERUWE1lc3NhZ2VPcHRpb25zXG4gKiBAcHJvcGVydHkge251bWJlcn0gaWRlbnRpZmllciBwYWNrZXQgdHJhbnNtaXNzaW9uIHNlcXVlbmNlLCB0aGlzIHZhbHVlIGlzIGluY3JlbWVudGVkIGZvciBlYWNoIHJlcXVlc3RcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBjaGFubmVsQ29kZSB0aGUgZGF0YSB0cmFuc21pc3Npb24gb2YgdGhlIHNlcnZpY2Ugd2lsbCB1c2UgdGhpcyBjaGFubmVsIGNvZGUuXG4gKiBFYWNoIHNlcnZpY2UgaGFzIGEgc2VwYXJhdGUgY2hhbm5lbFxuICogQHByb3BlcnR5IHtudW1iZXI/fSBwYXlsb2FkTGVuZ3RoIERUWE1lc3NhZ2VBdXhCdWZmZXIubGVuZ3RoKG51bGxhYmxlKSArIHNlbGVjdG9yQnVmZmVyLmxlbmd0aChudWxsYWJsZSlcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gZXhwZWN0c1JlcGx5IGlmIHRydWUgcmVwbHkgYSBhY2sgbWVzc2FnZVxuICogQHByb3BlcnR5IHtudW1iZXJ9IGNvbnZlcnNhdGlvbkluZGV4ICByYXcgZGF0YSArMSBpbmRpY2F0ZSBhIHJlcGx5IG1lc3NhZ2VcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBmbGFncyBtZXNzYWdlIHN0YXR1c1xuICovXG5cbmNsYXNzIERUWE1lc3NhZ2VIZWFkZXIge1xuICAvKipcbiAgICogQHBhcmFtIHtEVFhNZXNzYWdlT3B0aW9uc30gZGF0YVxuICAgKiBAcmV0dXJucyB7QnVmZmVyfSBEVFhNZXNzYWdlSGVhZGVyQnVmZmVyXG4gICAqL1xuICBzdGF0aWMgYnVpbGQgKGRhdGEpIHtcbiAgICBjb25zdCBtZXNzYWdlSGVhZGVyID0gQnVmZmVyLmFsbG9jKERUWF9NRVNTQUdFX0hFQURFUl9MRU5HVEgpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShEVFhfTUVTU0FHRV9IRUFERVJfTUFHSUMsIDApO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShEVFhfTUVTU0FHRV9IRUFERVJfTEVOR1RILCA0KTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDE2TEUoMCwgOCk7XG4gICAgbWVzc2FnZUhlYWRlci53cml0ZVVJbnQxNkxFKDEsIDEwKTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDMyTEUoZGF0YS5wYXlsb2FkTGVuZ3RoLCAxMik7XG4gICAgbWVzc2FnZUhlYWRlci53cml0ZVVJbnQzMkxFKGRhdGEuaWRlbnRpZmllciwgMTYpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShkYXRhLmNvbnZlcnNhdGlvbkluZGV4LCAyMCk7XG4gICAgbWVzc2FnZUhlYWRlci53cml0ZVVJbnQzMkxFKGRhdGEuY2hhbm5lbENvZGUsIDI0KTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDMyTEUoZGF0YS5leHBlY3RzUmVwbHksIDI4KTtcbiAgICByZXR1cm4gbWVzc2FnZUhlYWRlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gaGVhZGVyQnVmZmVyIERUWE1lc3NhZ2VIZWFkZXJCdWZmZXJcbiAgICogQHJldHVybnMge09iamVjdH1cbiAgICovXG4gIHN0YXRpYyBwYXJzZSAoaGVhZGVyQnVmZmVyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1hZ2ljOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDApLFxuICAgICAgaGVhZGVyTGVuZ3RoOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDQpLFxuICAgICAgZnJhZ21lbnRJZDogaGVhZGVyQnVmZmVyLnJlYWRVSW50MTZMRSg4KSxcbiAgICAgIGZyYWdtZW50Q291bnQ6IGhlYWRlckJ1ZmZlci5yZWFkVUludDE2TEUoMTApLFxuICAgICAgcGF5bG9hZExlbmd0aDogaGVhZGVyQnVmZmVyLnJlYWRVSW50MzJMRSgxMiksXG4gICAgICBpZGVudGlmaWVyOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDE2KSxcbiAgICAgIGNvbnZlcnNhdGlvbkluZGV4OiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDIwKSxcbiAgICAgIGNoYW5uZWw6IGhlYWRlckJ1ZmZlci5yZWFkVUludDMyTEUoMjQpLFxuICAgICAgZXhwZWN0c1JlcGx5OiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDI4KSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIgbGVuZ3RoIDE2XG4gKiBzdHJ1Y3QgRFRYTWVzc2FnZUhlYWRlciB7XG4gKiAgICAgdTMyIGZsYWdzIEZMQUdfVFlQRVNcbiAqICAgICB1MzIgYXV4TGVuZ3RoXG4gKiAgICAgdTY0IHRvdGFsTGVuZ3RoXG4gKiAgICAgfVxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gRFRYTWVzc2FnZVBheWxvYWRIZWFkZXJPYmplY3RcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBmbGFncyBtZXNzYWdlIHN0YXR1c1xuICogQHByb3BlcnR5IHtudW1iZXJ9IGF1eExlbmd0aCBEVFhNZXNzYWdlQXV4QnVmZmVyLmxlbmd0aChudWxsYWJsZSlcbiAqIEBwcm9wZXJ0eSB7YmlnaW50fSB0b3RhbExlbmd0aCBEVFhNZXNzYWdlQXV4QnVmZmVyLmxlbmd0aChudWxsYWJsZSkgKyBzZWxlY3RvckJ1ZmZlci5sZW5ndGhcbiAqL1xuY2xhc3MgRFRYTWVzc2FnZVBheWxvYWRIZWFkZXIge1xuICAvKipcbiAgICogQHBhcmFtIGRhdGEge0RUWE1lc3NhZ2VQYXlsb2FkSGVhZGVyT2JqZWN0fVxuICAgKiBAcmV0dXJucyB7QnVmZmVyfSBEVFhNZXNzYWdlUGF5bG9hZEhlYWRlckJ1ZmZlclxuICAgKi9cbiAgc3RhdGljIGJ1aWxkIChkYXRhKSB7XG4gICAgY29uc3QgbWVzc2FnZUhlYWRlciA9IEJ1ZmZlci5hbGxvYyhEVFhfTUVTU0FHRV9QQVlMT0FEX0hFQURFUl9MRU5HVEgpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVVSW50MzJMRShkYXRhLmZsYWdzLCAwKTtcbiAgICBtZXNzYWdlSGVhZGVyLndyaXRlVUludDMyTEUoZGF0YS5hdXhMZW5ndGgsIDQpO1xuICAgIG1lc3NhZ2VIZWFkZXIud3JpdGVCaWdVSW50NjRMRShkYXRhLnRvdGFsTGVuZ3RoLCA4KTtcbiAgICByZXR1cm4gbWVzc2FnZUhlYWRlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gaGVhZGVyQnVmZmVyXG4gICAqIEByZXR1cm5zIHtEVFhNZXNzYWdlUGF5bG9hZEhlYWRlck9iamVjdH1cbiAgICovXG4gIHN0YXRpYyBwYXJzZSAoaGVhZGVyQnVmZmVyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGZsYWdzOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDApLFxuICAgICAgYXV4TGVuZ3RoOiBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKDQpLFxuICAgICAgdG90YWxMZW5ndGg6IGhlYWRlckJ1ZmZlci5yZWFkQmlnSW50NjRMRSg4KVxuICAgIH07XG4gIH1cbn1cblxuXG5jbGFzcyBEVFhNZXNzYWdlQXV4IHtcbiAgLyoqXG4gICAqIEBwYXJhbSB7YW55W10gfCBEVFhNZXNzYWdlQXV4QnVmZmVyfSBkYXRhXG4gICAqL1xuICBjb25zdHJ1Y3RvciAoZGF0YSA9IFtdKSB7XG4gICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgfVxuXG4gIC8qKlxuICAgKiBKUyBBcnJheSB0byBBcHBsZSBOU0tleWVkIEJ1ZmZlclxuICAgKiBAcmV0dXJucyB7QnVmZmVyfVxuICAgKi9cbiAgYnVpbGQgKCkge1xuICAgIGlmICh0aGlzLmRhdGEgaW5zdGFuY2VvZiBEVFhNZXNzYWdlQXV4QnVmZmVyKSB7XG4gICAgICByZXR1cm4gdGhpcy5kYXRhLmdldEJ5dGVzKCk7XG4gICAgfVxuICAgIGNvbnN0IG1lc3NhZ2VBdXggPSBuZXcgRFRYTWVzc2FnZUF1eEJ1ZmZlcigpO1xuICAgIGxldCBidWYgPSBCdWZmZXIuYWxsb2MoMCk7XG4gICAgZm9yIChjb25zdCBhcmcgb2YgdGhpcy5kYXRhKSB7XG4gICAgICBpZiAoYXJnIGluc3RhbmNlb2YgRFRYTWVzc2FnZUF1eEJ1ZmZlcikge1xuICAgICAgICBidWYgPSBCdWZmZXIuY29uY2F0KFtidWYsIGFyZy5nZXRCeXRlcygpXSk7XG4gICAgICB9IGVsc2UgaWYgKF8uaXNOdW1iZXIoYXJnKSkge1xuICAgICAgICBtZXNzYWdlQXV4LmFwcGVuZEludChhcmcpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYXJnID09ICdiaWdpbnQnKSB7XG4gICAgICAgIG1lc3NhZ2VBdXguYXBwZW5kTG9uZyhhcmcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWVzc2FnZUF1eC5hcHBlbmRPYmplY3QoYXJnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIEJ1ZmZlci5jb25jYXQoW2J1ZiwgbWVzc2FnZUF1eC5nZXRCeXRlcygpXSk7XG4gIH1cblxuICAvKipcbiAgICogUGFyc2VzIG5za2V5ZWQgQnVmZmVyIGludG8ganMgYXJyYXlcbiAgICogQHBhcmFtIHtCdWZmZXJ9IGhlYWRlckJ1ZmZlclxuICAgKiBAcGFyYW0ge0RUWE1lc3NhZ2VQYXlsb2FkSGVhZGVyT2JqZWN0fSBwYXlsb2FkSGVhZGVyXG4gICAqIEByZXR1cm5zIHtBcnJheX1cbiAgICovXG4gIHN0YXRpYyBwYXJzZSAoaGVhZGVyQnVmZmVyLCBwYXlsb2FkSGVhZGVyKSB7XG4gICAgbGV0IGN1cnNvciA9IDA7XG4gICAgY29uc3QgZGF0YSA9IFtdO1xuICAgIGNvbnN0IGxlbmd0aCA9IGhlYWRlckJ1ZmZlci5yZWFkQmlnSW50NjRMRSg4KTtcbiAgICBjdXJzb3IgKz0gMTY7XG4gICAgd2hpbGUgKGN1cnNvciA8PSBsZW5ndGgpIHtcbiAgICAgIGlmIChwYXlsb2FkSGVhZGVyLmZsYWdzICE9PSBGTEFHX1RZUEVTLnB1c2gpIHtcbiAgICAgICAgY29uc3QgbSA9IGhlYWRlckJ1ZmZlci5yZWFkVUludDMyTEUoY3Vyc29yKTtcbiAgICAgICAgY3Vyc29yICs9IDQ7XG4gICAgICAgIGlmIChtICE9PSBEVFhfQVVYSUxJQVJZX01BR0lDKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBpbmNvcnJlY3QgYXV4aWxpYXJ5IG1hZ2ljOiAke219YCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0IHR5cGUgPSBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKGN1cnNvcik7XG4gICAgICBjdXJzb3IgKz0gNDtcbiAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIEFVWF9UWVBFUy5UZXh0OiB7XG4gICAgICAgICAgY29uc3Qgc3RyTGVuID0gaGVhZGVyQnVmZmVyLnJlYWRVSW50MzJMRShjdXJzb3IpO1xuICAgICAgICAgIGN1cnNvciArPSA0O1xuICAgICAgICAgIGRhdGEucHVzaChoZWFkZXJCdWZmZXIuc2xpY2UoY3Vyc29yLCBjdXJzb3IgKyBzdHJMZW4pKTtcbiAgICAgICAgICBjdXJzb3IgKz0gc3RyTGVuO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgQVVYX1RZUEVTLk5TS2V5ZWQ6IHtcbiAgICAgICAgICBjb25zdCBzdHJMZW4gPSBoZWFkZXJCdWZmZXIucmVhZFVJbnQzMkxFKGN1cnNvcik7XG4gICAgICAgICAgY3Vyc29yICs9IDQ7XG4gICAgICAgICAgY29uc3QgYXJjaGl2ZWRfZGF0YSA9IGhlYWRlckJ1ZmZlci5zbGljZShjdXJzb3IsIGN1cnNvciArIHN0ckxlbik7XG4gICAgICAgICAgZGF0YS5wdXNoKHVuYXJjaGl2ZShhcmNoaXZlZF9kYXRhKSk7XG4gICAgICAgICAgY3Vyc29yICs9IHN0ckxlbjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIEFVWF9UWVBFUy5VSW50MzJMRTpcbiAgICAgICAgICBkYXRhLnB1c2goaGVhZGVyQnVmZmVyLnJlYWRVSW50MzJMRShjdXJzb3IpKTtcbiAgICAgICAgICBjdXJzb3IgKz0gNDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBVVhfVFlQRVMuQmlnVUludDY0TEU6XG4gICAgICAgICAgZGF0YS5wdXNoKGhlYWRlckJ1ZmZlci5yZWFkQmlnVUludDY0TEUoY3Vyc29yKSk7XG4gICAgICAgICAgY3Vyc29yICs9IDg7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQVVYX1RZUEVTLkJpZ0ludDY0TEU6XG4gICAgICAgICAgZGF0YS5wdXNoKGhlYWRlckJ1ZmZlci5yZWFkQmlnSW50NjRMRShjdXJzb3IpKTtcbiAgICAgICAgICBjdXJzb3IgKz0gODtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gdHlwZSAke3R5cGV9YCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xuICB9XG59XG5cbmNsYXNzIEluc3RydW1lbnRSUENQYXJzZUVycm9yIHtcbiAgY29uc3RydWN0b3IgKGRhdGEpIHtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICB9XG59XG5cbmNsYXNzIERUWE1lc3NhZ2VBdXhCdWZmZXIge1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgdGhpcy5fYnVmID0gQnVmZmVyLmFsbG9jKDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZVxuICAgKi9cbiAgYXBwZW5kSW50ICh2YWx1ZSkge1xuICAgIGNvbnN0IGJ1ZiA9IEJ1ZmZlci5hbGxvYygxMik7XG4gICAgYnVmLndyaXRlVUludDMyTEUoRFRYX0FVWElMSUFSWV9NQUdJQywgMCk7XG4gICAgYnVmLndyaXRlVUludDMyTEUoMywgNCk7XG4gICAgYnVmLndyaXRlVUludDMyTEUodmFsdWUsIDgpO1xuICAgIHRoaXMuX2J1ZiA9IEJ1ZmZlci5jb25jYXQoW3RoaXMuX2J1ZiwgYnVmXSk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtiaWdpbnR9IHZhbHVlXG4gICAqL1xuICBhcHBlbmRMb25nICh2YWx1ZSkge1xuICAgIGNvbnN0IGJ1ZiA9IEJ1ZmZlci5hbGxvYygxNik7XG4gICAgYnVmLndyaXRlVUludDMyTEUoRFRYX0FVWElMSUFSWV9NQUdJQywgMCk7XG4gICAgYnVmLndyaXRlVUludDMyTEUoNCwgNCk7XG4gICAgYnVmLndyaXRlQmlnVUludDY0TEUodmFsdWUsIDgpO1xuICAgIHRoaXMuX2J1ZiA9IEJ1ZmZlci5jb25jYXQoW3RoaXMuX2J1ZiwgYnVmXSk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlXG4gICAqL1xuICBhcHBlbmRTaWduZWRJbnQgKHZhbHVlKSB7XG4gICAgY29uc3QgYnVmID0gQnVmZmVyLmFsbG9jKDEyKTtcbiAgICBidWYud3JpdGVVSW50MzJMRShEVFhfQVVYSUxJQVJZX01BR0lDLCAwKTtcbiAgICBidWYud3JpdGVVSW50MzJMRSgzLCA0KTtcbiAgICBidWYud3JpdGVJbnQzMkxFKHZhbHVlLCA4KTtcbiAgICB0aGlzLl9idWYgPSBCdWZmZXIuY29uY2F0KFt0aGlzLl9idWYsIGJ1Zl0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7YmlnaW50fSB2YWx1ZVxuICAgKi9cbiAgYXBwZW5kU2lnbmVkTG9uZyAodmFsdWUpIHtcbiAgICBjb25zdCBidWYgPSBCdWZmZXIuYWxsb2MoMTYpO1xuICAgIGJ1Zi53cml0ZVVJbnQzMkxFKERUWF9BVVhJTElBUllfTUFHSUMsIDApO1xuICAgIGJ1Zi53cml0ZVVJbnQzMkxFKDYsIDQpO1xuICAgIGJ1Zi53cml0ZUJpZ0ludDY0TEUodmFsdWUsIDgpO1xuICAgIHRoaXMuX2J1ZiA9IEJ1ZmZlci5jb25jYXQoW3RoaXMuX2J1ZiwgYnVmXSk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtPYmplY3R9IHZhbHVlXG4gICAqL1xuICBhcHBlbmRPYmplY3QgKHZhbHVlKSB7XG4gICAgY29uc3QgYnVmID0gYXJjaGl2ZSh2YWx1ZSk7XG4gICAgY29uc3QgYnVmMiA9IEJ1ZmZlci5hbGxvYygxMik7XG4gICAgYnVmMi53cml0ZVVJbnQzMkxFKERUWF9BVVhJTElBUllfTUFHSUMsIDApO1xuICAgIGJ1ZjIud3JpdGVVSW50MzJMRSgyLCA0KTtcbiAgICBidWYyLndyaXRlVUludDMyTEUoYnVmLmxlbmd0aCwgOCk7XG4gICAgdGhpcy5fYnVmID0gQnVmZmVyLmNvbmNhdChbdGhpcy5fYnVmLCBidWYyLCBidWZdKTtcbiAgfVxuXG4gIGdldEJ5dGVzICgpIHtcbiAgICBjb25zdCBvdXQgPSBCdWZmZXIuYWxsb2MoMTYpO1xuICAgIG91dC53cml0ZVVJbnQzMkxFKERUWF9NRVNTQUdFX0FVWF9IRUFERVIsIDApO1xuICAgIG91dC53cml0ZVVJbnQzMkxFKHRoaXMuX2J1Zi5sZW5ndGgsIDgpO1xuICAgIHJldHVybiBCdWZmZXIuY29uY2F0KFtvdXQsIHRoaXMuX2J1Zl0pO1xuICB9XG59XG5cblxuXG5jbGFzcyBEVFhNZXNzYWdlIHtcbiAgLyoqXG4gICAqIEBwYXJhbSB7RFRYTWVzc2FnZU9wdGlvbnN9IG9wdHNcbiAgICovXG4gIGNvbnN0cnVjdG9yIChvcHRzID0ge30pIHtcbiAgICBjb25zdCB7XG4gICAgICBpZGVudGlmaWVyLFxuICAgICAgY2hhbm5lbENvZGUsXG4gICAgICBzZWxlY3RvcixcbiAgICAgIGV4cGVjdHNSZXBseSxcbiAgICAgIGNvbnZlcnNhdGlvbkluZGV4ID0gMCxcbiAgICAgIGZsYWdzID0gRkxBR19UWVBFUy5zZW5kXG4gICAgfSA9IG9wdHM7XG4gICAgdGhpcy5fbWVzc2FnZUhlYWRlciA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLl9wYXlsb2FkSGVhZGVyID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuX2lkZW50aWZpZXIgPSBpZGVudGlmaWVyO1xuICAgIHRoaXMuX2NoYW5uZWxDb2RlID0gY2hhbm5lbENvZGU7XG4gICAgdGhpcy5fZXhwZWN0c1JlcGx5ID0gZXhwZWN0c1JlcGx5O1xuICAgIHRoaXMuX3NlbGVjdG9yID0gc2VsZWN0b3I7XG4gICAgdGhpcy5fY29udmVyc2F0aW9uSW5kZXggPSBjb252ZXJzYXRpb25JbmRleDtcbiAgICB0aGlzLl9mbGFncyA9IGZsYWdzO1xuICAgIHRoaXMuYXV4aWxpYXJpZXMgPSBuZXcgRFRYTWVzc2FnZUF1eCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIGdldCBEVFhNZXNzYWdlSGVhZGVyIGlkZW50aWZpZXIuIFBhY2tldCB0cmFuc21pc3Npb24gc2VxdWVuY2VcbiAgICogQHJldHVybnMge251bWJlcn1cbiAgICovXG4gIGdldCBpZGVudGlmaWVyICgpIHtcbiAgICByZXR1cm4gdGhpcy5fbWVzc2FnZUhlYWRlcj8uaWRlbnRpZmllcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBnZXQgRFRYTWVzc2FnZUhlYWRlciBjaGFubmVsQ29kZS5cbiAgICogUGFja2V0IHRyYW5zbWlzc2lvbiBjaGFubmVsQ29kZS4gVXNlIHRoaXMgdmFsdWUgdG8gZGlzdGluZ3Vpc2ggd2hlbiB0aGVyZSBhcmUgbXVsdGlwbGUgY2hhbm5lbHNcbiAgICogY2FsbCB0aGlzIG1ldGhvZCBgSW5zdHJ1bWVudFNlcnZpY2UucmVnaXN0ZXJDaGFubmVsQ2FsbGJhY2tgIGdldCB0aGUgY2hhbm5lbCBtZXNzYWdlXG4gICAqIEByZXR1cm5zIHtudW1iZXJ9XG4gICAqL1xuICBnZXQgY2hhbm5lbENvZGUgKCkge1xuICAgIHJldHVybiB0aGlzLl9tZXNzYWdlSGVhZGVyPy5jaGFubmVsO1xuICB9XG5cbiAgLyoqXG4gICAqIGdldCBEVFhNZXNzYWdlSGVhZGVyIGV4cGVjdHNSZXBseS4gV2hldGhlciB0byBuZWVkIGFjayBtZXNzYWdlXG4gICAqIGlmIGV4cGVjdHNSZXBseSBpcyB0cnVlIG11c3QgcmVwbHkgYWNrIG1lc3NhZ2VcbiAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAqL1xuICBnZXQgZXhwZWN0c1JlcGx5ICgpIHtcbiAgICByZXR1cm4gdGhpcy5fbWVzc2FnZUhlYWRlcj8uZXhwZWN0c1JlcGx5O1xuICB9XG5cbiAgLyoqXG4gICAqIGNhbGwgdGhpcyBtZXRob2QgYEluc3RydW1lbnRTZXJ2aWNlLnJlZ2lzdGVyU2VsZWN0b3JDYWxsYmFja2AgZ2V0IHRoZSBzZWxlY3RvciBtZXNzYWdlXG4gICAqIEByZXR1cm5zIHsqfSBVbmtub3duIGRhdGFcbiAgICovXG4gIGdldCBzZWxlY3RvciAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlbGVjdG9yO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBkYXRhXG4gICAqL1xuICBzZXQgc2VsZWN0b3IgKGRhdGEpIHtcbiAgICB0aGlzLl9zZWxlY3RvciA9IGRhdGE7XG4gIH1cblxuICAvKipcbiAgICogZ2V0IERUWE1lc3NhZ2VIZWFkZXIgY29udmVyc2F0aW9uSW5kZXhcbiAgICogQHJldHVybnMge251bWJlcn1cbiAgICovXG4gIGdldCBjb252ZXJzYXRpb25JbmRleCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21lc3NhZ2VIZWFkZXI/LmNvbnZlcnNhdGlvbkluZGV4O1xuICB9XG5cbiAgLyoqXG4gICAqIERUWE1lc3NhZ2UgQnVmZmVyOiBEVFhNZXNzYWdlSGVhZGVyICsgUGF5bG9hZEhlYWRlciArIERUWE1lc3NhZ2VBdXhCdWZmZXIobnVsbGFibGUpICsgc2VsZWN0b3IobnVsbGFibGUpXG4gICAqIEByZXR1cm5zIHtCdWZmZXJ9XG4gICAqL1xuICBidWlsZCAoKSB7XG4gICAgY29uc3Qgc2VsID0gdGhpcy5fc2VsZWN0b3IgPyBhcmNoaXZlKHRoaXMuX3NlbGVjdG9yKSA6IEJ1ZmZlci5hbGxvYygwKTtcbiAgICBjb25zdCBhdXggPSB0aGlzLmF1eGlsaWFyaWVzLmJ1aWxkKCk7XG4gICAgY29uc3QgcGF5bG9hZEhlYWRlciA9IERUWE1lc3NhZ2VQYXlsb2FkSGVhZGVyLmJ1aWxkKHtcbiAgICAgIGZsYWdzOiB0aGlzLl9mbGFncyxcbiAgICAgIGF1eExlbmd0aDogYXV4Lmxlbmd0aCxcbiAgICAgIC8vIG5lZWQgdG8gY29udmVydCB0byBiaWdpbnQgaW4gYW55IGNhc2VcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZlxuICAgICAgdG90YWxMZW5ndGg6IEJpZ0ludChhdXgubGVuZ3RoICsgc2VsLmxlbmd0aCksXG4gICAgfSk7XG5cbiAgICBjb25zdCBtZXNzYWdlSGVhZGVyID0gRFRYTWVzc2FnZUhlYWRlci5idWlsZCh7XG4gICAgICBwYXlsb2FkTGVuZ3RoOiBEVFhfTUVTU0FHRV9QQVlMT0FEX0hFQURFUl9MRU5HVEggKyBhdXgubGVuZ3RoICsgc2VsLmxlbmd0aCxcbiAgICAgIGlkZW50aWZpZXI6IHRoaXMuX2lkZW50aWZpZXIsXG4gICAgICBjb252ZXJzYXRpb25JbmRleDogdGhpcy5fY29udmVyc2F0aW9uSW5kZXgsXG4gICAgICBjaGFubmVsQ29kZTogdGhpcy5fY2hhbm5lbENvZGUsXG4gICAgICBleHBlY3RzUmVwbHk6IHRoaXMuX2V4cGVjdHNSZXBseVxuICAgIH0pO1xuICAgIHJldHVybiBCdWZmZXIuY29uY2F0KFttZXNzYWdlSGVhZGVyLCBwYXlsb2FkSGVhZGVyLCBhdXgsIHNlbF0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlcyBEVFggYnVmZmVyIGludG8gYW4ganMgb2JqZWN0LiBSZXR1cm5lZCBpbiBEVFhEZWNvZGVyIFN0cmVhbS5UcmFuc2Zvcm1cbiAgICogQHBhcmFtIHtCdWZmZXJ9IGhlYWRlckJ1ZiAgRFRYTWVzc2FnZUhlYWRlciBidWZmZXJcbiAgICogQHBhcmFtIHtCdWZmZXJ9IHBheWxvYWRCdWYgIFBheWxvYWRIZWFkZXJCdWZmZXIgKyBEVFhNZXNzYWdlQXV4QnVmZmVyKG51bGxhYmxlKSArIHNlbGVjdG9yQnVmZmVyKG51bGxhYmxlKVxuICAgKiBAcmV0dXJucyB7RFRYTWVzc2FnZX1cbiAgICovXG4gIHN0YXRpYyBwYXJzZSAoaGVhZGVyQnVmLCBwYXlsb2FkQnVmKSB7XG4gICAgbGV0IGN1cnNvciA9IDA7XG4gICAgY29uc3QgcmV0ID0gbmV3IERUWE1lc3NhZ2UoKTtcbiAgICByZXQuX21lc3NhZ2VIZWFkZXIgPSBEVFhNZXNzYWdlSGVhZGVyLnBhcnNlKGhlYWRlckJ1Zik7XG4gICAgaWYgKHJldC5fbWVzc2FnZUhlYWRlci5wYXlsb2FkTGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gcmV0O1xuICAgIH1cbiAgICByZXQuX3BheWxvYWRIZWFkZXIgPSBEVFhNZXNzYWdlUGF5bG9hZEhlYWRlci5wYXJzZShwYXlsb2FkQnVmLnNsaWNlKGN1cnNvciwgRFRYX01FU1NBR0VfUEFZTE9BRF9IRUFERVJfTEVOR1RIKSk7XG4gICAgY3Vyc29yICs9IERUWF9NRVNTQUdFX1BBWUxPQURfSEVBREVSX0xFTkdUSDtcbiAgICAvLyB0b3RhbExlbmd0aCBpcyBiaWdpbnQgdXNlIDBuXG4gICAgaWYgKHJldC5fcGF5bG9hZEhlYWRlci50b3RhbExlbmd0aCA9PT0gMG4pIHtcbiAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuICAgIGlmIChyZXQuX3BheWxvYWRIZWFkZXIuYXV4TGVuZ3RoID4gMCkge1xuICAgICAgcmV0LmF1eGlsaWFyaWVzID0gRFRYTWVzc2FnZUF1eC5wYXJzZShwYXlsb2FkQnVmLnNsaWNlKGN1cnNvciwgY3Vyc29yICsgcmV0Ll9wYXlsb2FkSGVhZGVyLmF1eExlbmd0aCksIHJldC5fcGF5bG9hZEhlYWRlcik7XG4gICAgICBjdXJzb3IgKz0gcmV0Ll9wYXlsb2FkSGVhZGVyLmF1eExlbmd0aDtcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhID0gcGF5bG9hZEJ1Zi5zbGljZShjdXJzb3IsIGN1cnNvciArIHBheWxvYWRCdWYubGVuZ3RoKTtcbiAgICByZXQuc2VsZWN0b3IgPSBkYXRhO1xuICAgIGlmIChkYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAoY29uc3QgZnVuIG9mIFt1bmFyY2hpdmUsIHBsaXN0bGliLnBhcnNlQnVmZmVyXSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldC5zZWxlY3RvciA9IGZ1bihkYXRhKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJldC5zZWxlY3RvciA9IG5ldyBJbnN0cnVtZW50UlBDUGFyc2VFcnJvcihkYXRhKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmV0O1xuICB9XG59XG5cbmV4cG9ydCB7IERUWE1lc3NhZ2VIZWFkZXIsIERUWE1lc3NhZ2VQYXlsb2FkSGVhZGVyLCBEVFhNZXNzYWdlQXV4QnVmZmVyLCBEVFhNZXNzYWdlQXV4LCBEVFhNZXNzYWdlLFxuICBEVFhfTUVTU0FHRV9QQVlMT0FEX0hFQURFUl9MRU5HVEgsIERUWF9NRVNTQUdFX0hFQURFUl9MRU5HVEgsIERUWF9NRVNTQUdFX0hFQURFUl9NQUdJQywgRFRYX01FU1NBR0VfSEVBREVSX01BR0lDX0xFTixcbiAgRkxBR19UWVBFU307XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsSUFBQUEsUUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsYUFBQSxHQUFBQyxzQkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsT0FBQSxHQUFBRCxzQkFBQSxDQUFBRixPQUFBO0FBRUEsTUFBTUksaUNBQWlDLEdBQUcsRUFBRTtBQUFDQyxPQUFBLENBQUFELGlDQUFBLEdBQUFBLGlDQUFBO0FBQzdDLE1BQU1FLHlCQUF5QixHQUFHLEVBQUU7QUFBQ0QsT0FBQSxDQUFBQyx5QkFBQSxHQUFBQSx5QkFBQTtBQUNyQyxNQUFNQyx3QkFBd0IsR0FBRyxVQUFVO0FBQUNGLE9BQUEsQ0FBQUUsd0JBQUEsR0FBQUEsd0JBQUE7QUFDNUMsTUFBTUMsNEJBQTRCLEdBQUcsQ0FBQztBQUFDSCxPQUFBLENBQUFHLDRCQUFBLEdBQUFBLDRCQUFBO0FBQ3ZDLE1BQU1DLHNCQUFzQixHQUFHLE1BQU07QUFDckMsTUFBTUMsbUJBQW1CLEdBQUcsR0FBRztBQUUvQixNQUFNQyxVQUFVLEdBQUdDLE1BQU0sQ0FBQ0MsTUFBTSxDQUFDO0VBQy9CQyxJQUFJLEVBQUUsQ0FBQztFQUNQQyxJQUFJLEVBQUUsQ0FBQztFQUNQQyxJQUFJLEVBQUUsQ0FBQztFQUNQQyxLQUFLLEVBQUU7QUFDVCxDQUFDLENBQUM7QUFBQ1osT0FBQSxDQUFBTSxVQUFBLEdBQUFBLFVBQUE7QUFFSCxNQUFNTyxTQUFTLEdBQUdOLE1BQU0sQ0FBQ0MsTUFBTSxDQUFDO0VBQzlCTSxJQUFJLEVBQUUsQ0FBQztFQUNQQyxPQUFPLEVBQUUsQ0FBQztFQUNWQyxRQUFR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