"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.startAfcService = startAfcService;
exports.startCrashLogService = startCrashLogService;
exports.startHouseArrestService = startHouseArrestService;
exports.startInstallationProxyService = startInstallationProxyService;
exports.startInstrumentService = startInstrumentService;
exports.startMCInstallService = startMCInstallService;
exports.startNotificationProxyService = startNotificationProxyService;
exports.startSimulateLocationService = startSimulateLocationService;
exports.startSyslogService = startSyslogService;
exports.startTestmanagerdService = startTestmanagerdService;
exports.startWebInspectorService = startWebInspectorService;
require("source-map-support/register");
var _utilities = require("./utilities");
var _syslog = require("./syslog");
var _simulatelocation = require("./simulatelocation");
var _webinspector = require("./webinspector");
var _installationProxy = require("./installation-proxy");
var _afc = require("./afc");
var _notificationProxy = require("./notification-proxy");
var _houseArrest = require("./house-arrest");
var _instrument = require("./instrument");
var _testmanagerd = require("./testmanagerd");
var _mcinstall = require("./mcinstall");
var _plistService = _interopRequireDefault(require("./plist-service"));
var _semver = _interopRequireDefault(require("semver"));
const CRASH_LOG_SERVICE_NAME = 'com.apple.crashreportcopymobile';
const INSTRUMENT_HANDSHAKE_VERSION = 14;
const TESTMANAGERD_HANDSHAKE_VERSION = 14;
async function startSyslogService(udid, opts = {}) {
  const socket = await startService(udid, _syslog.SYSLOG_SERVICE_NAME, opts.socket);
  return new _syslog.SyslogService(socket);
}
async function startSimulateLocationService(udid, opts = {}) {
  const socket = await startService(udid, _simulatelocation.SIMULATE_LOCATION_SERVICE_NAME, opts.socket);
  return new _simulatelocation.SimulateLocationService(socket);
}
async function startWebInspectorService(udid, opts = {}) {
  const osVersion = opts.osVersion || (await (0, _utilities.getOSVersion)(udid, opts.socket));
  const isSimulator = !!opts.isSimulator;
  const verbose = !!opts.verbose;
  const verboseHexDump = !!opts.verboseHexDump;
  const socketChunkSize = opts.socketChunkSize;
  const maxFrameLength = opts.maxFrameLength;
  const semverVersion = _semver.default.coerce(osVersion);
  if (!semverVersion) {
    throw new Error(`Could not create a semver version out of '${osVersion}'`);
  }
  if (opts.socket) {
    return new _webinspector.WebInspectorService({
      majorOsVersion: semverVersion.major,
      isSimulator,
      socketChunkSize,
      verbose,
      verboseHexDump,
      socketClient: opts.socket,
      maxFrameLength
    });
  }
  const socket = await startService(udid, _webinspector.WEB_INSPECTOR_SERVICE_NAME, undefined);
  return new _webinspector.WebInspectorService({
    majorOsVersion: semverVersion.major,
    isSimulator,
    socketChunkSize,
    verbose,
    verboseHexDump,
    socketClient: socket,
    maxFrameLength
  });
}
async function startInstallationProxyService(udid, opts = {}) {
  const socket = await startService(udid, _installationProxy.INSTALLATION_PROXY_SERVICE_NAME, opts.socket);
  return new _installationProxy.InstallationProxyService(new _plistService.default(socket));
}
async function startAfcService(udid, opts = {}) {
  const socket = await startService(udid, _afc.AFC_SERVICE_NAME, opts.socket);
  return new _afc.AfcService(socket);
}
async function startCrashLogService(udid, opts = {}) {
  const socket = await startService(udid, CRASH_LOG_SERVICE_NAME, opts.socket);
  return new _afc.AfcService(socket);
}
async function startNotificationProxyService(udid, opts = {}) {
  const socket = await startService(udid, _notificationProxy.NOTIFICATION_PROXY_SERVICE_NAME, opts.socket);
  return new _notificationProxy.NotificationProxyService(socket);
}
async function startHouseArrestService(udid, opts = {}) {
  const socket = await startService(udid, _houseArrest.HOUSE_ARREST_SERVICE_NAME, opts.socket);
  return new _houseArrest.HouseArrestService(socket);
}
async function startInstrumentService(udid, opts = {}) {
  const osVersion = opts.osVersion || (await (0, _utilities.getOSVersion)(udid, opts.socket));
  return new _instrument.InstrumentService(parseInt(osVersion.split('.')[0], 10) < INSTRUMENT_HANDSHAKE_VERSION ? await startService(udid, _instrument.INSTRUMENT_SERVICE_NAME, opts.socket, true) : await startService(udid, _instrument.INSTRUMENT_SERVICE_NAME_VERSION_14, opts.socket));
}
async function startTestmanagerdService(udid, opts = {}) {
  const osVersion = opts.osVersion || (await (0, _utilities.getOSVersion)(udid, opts.socket));
  return new _testmanagerd.TestmanagerdService(parseInt(osVersion.split('.')[0], 10) < TESTMANAGERD_HANDSHAKE_VERSION ? await startService(udid, _testmanagerd.TESTMANAGERD_SERVICE_NAME, opts.socket, true) : await startService(udid, _testmanagerd.TESTMANAGERD_SERVICE_NAME_VERSION_14, opts.socket));
}
async function startMCInstallService(udid, opts = {}) {
  const socket = await startService(udid, _mcinstall.MC_INSTALL_SERVICE_NAME, opts.socket);
  return new _mcinstall.MCInstallProxyService(new _plistService.default(socket));
}
async function startService(udid, serviceName, socket, handshakeOnly = false) {
  const lockdown = await (0, _utilities.startLockdownSession)(udid, socket);
  try {
    const service = await lockdown.startService(serviceName);
    if (service.EnableServiceSSL) {
      return await (0, _utilities.connectPortSSL)(udid, service.Port, socket, handshakeOnly);
    } else {
      return await (0, _utilities.connectPort)(udid, service.Port, socket);
    }
  } finally {
    lockdown.close();
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdXRpbGl0aWVzIiwicmVxdWlyZSIsIl9zeXNsb2ciLCJfc2ltdWxhdGVsb2NhdGlvbiIsIl93ZWJpbnNwZWN0b3IiLCJfaW5zdGFsbGF0aW9uUHJveHkiLCJfYWZjIiwiX25vdGlmaWNhdGlvblByb3h5IiwiX2hvdXNlQXJyZXN0IiwiX2luc3RydW1lbnQiLCJfdGVzdG1hbmFnZXJkIiwiX21jaW5zdGFsbCIsIl9wbGlzdFNlcnZpY2UiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX3NlbXZlciIsIkNSQVNIX0xPR19TRVJWSUNFX05BTUUiLCJJTlNUUlVNRU5UX0hBTkRTSEFLRV9WRVJTSU9OIiwiVEVTVE1BTkFHRVJEX0hBTkRTSEFLRV9WRVJTSU9OIiwic3RhcnRTeXNsb2dTZXJ2aWNlIiwidWRpZCIsIm9wdHMiLCJzb2NrZXQiLCJzdGFydFNlcnZpY2UiLCJTWVNMT0dfU0VSVklDRV9OQU1FIiwiU3lzbG9nU2VydmljZSIsInN0YXJ0U2ltdWxhdGVMb2NhdGlvblNlcnZpY2UiLCJTSU1VTEFURV9MT0NBVElPTl9TRVJWSUNFX05BTUUiLCJTaW11bGF0ZUxvY2F0aW9uU2VydmljZSIsInN0YXJ0V2ViSW5zcGVjdG9yU2VydmljZSIsIm9zVmVyc2lvbiIsImdldE9TVmVyc2lvbiIsImlzU2ltdWxhdG9yIiwidmVyYm9zZSIsInZlcmJvc2VIZXhEdW1wIiwic29ja2V0Q2h1bmtTaXplIiwibWF4RnJhbWVMZW5ndGgiLCJzZW12ZXJWZXJzaW9uIiwic2VtdmVyIiwiY29lcmNlIiwiRXJyb3IiLCJXZWJJbnNwZWN0b3JTZXJ2aWNlIiwibWFqb3JPc1ZlcnNpb24iLCJtYWpvciIsInNvY2tldENsaWVudCIsIldFQl9JTlNQRUNUT1JfU0VSVklDRV9OQU1FIiwidW5kZWZpbmVkIiwic3RhcnRJbnN0YWxsYXRpb25Qcm94eVNlcnZpY2UiLCJJTlNUQUxMQVRJT05fUFJPWFlfU0VSVklDRV9OQU1FIiwiSW5zdGFsbGF0aW9uUHJveHlTZXJ2aWNlIiwiUGxpc3RTZXJ2aWNlIiwic3RhcnRBZmNTZXJ2aWNlIiwiQUZDX1NFUlZJQ0VfTkFNRSIsIkFmY1NlcnZpY2UiLCJzdGFydENyYXNoTG9nU2VydmljZSIsInN0YXJ0Tm90aWZpY2F0aW9uUHJveHlTZXJ2aWNlIiwiTk9USUZJQ0FUSU9OX1BST1hZX1NFUlZJQ0VfTkFNRSIsIk5vdGlmaWNhdGlvblByb3h5U2VydmljZSIsInN0YXJ0SG91c2VBcnJlc3RTZXJ2aWNlIiwiSE9VU0VfQVJSRVNUX1NFUlZJQ0VfTkFNRSIsIkhvdXNlQXJyZXN0U2VydmljZSIsInN0YXJ0SW5zdHJ1bWVudFNlcnZpY2UiLCJJbnN0cnVtZW50U2VydmljZSIsInBhcnNlSW50Iiwic3BsaXQiLCJJTlNUUlVNRU5UX1NFUlZJQ0VfTkFNRSIsIklOU1RSVU1FTlRfU0VSVklDRV9OQU1FX1ZFUlNJT05fMTQiLCJzdGFydFRlc3RtYW5hZ2VyZFNlcnZpY2UiLCJUZXN0bWFuYWdlcmRTZXJ2aWNlIiwiVEVTVE1BTkFHRVJEX1NFUlZJQ0VfTkFNRSIsIlRFU1RNQU5BR0VSRF9TRVJWSUNFX05BTUVfVkVSU0lPTl8xNCIsInN0YXJ0TUNJbnN0YWxsU2VydmljZSIsIk1DX0lOU1RBTExfU0VSVklDRV9OQU1FIiwiTUNJbnN0YWxsUHJveHlTZXJ2aWNlIiwic2VydmljZU5hbWUiLCJoYW5kc2hha2VPbmx5IiwibG9ja2Rvd24iLCJzdGFydExvY2tkb3duU2Vzc2lvbiIsInNlcnZpY2UiLCJFbmFibGVTZXJ2aWNlU1NMIiwiY29ubmVjdFBvcnRTU0wiLCJQb3J0IiwiY29ubmVjdFBvcnQiLCJjbG9zZSJdLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9zZXJ2aWNlcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25uZWN0UG9ydCwgY29ubmVjdFBvcnRTU0wsIHN0YXJ0TG9ja2Rvd25TZXNzaW9uLCBnZXRPU1ZlcnNpb24gfSBmcm9tICcuL3V0aWxpdGllcyc7XG5pbXBvcnQgeyBTeXNsb2dTZXJ2aWNlLCBTWVNMT0dfU0VSVklDRV9OQU1FIH0gZnJvbSAnLi9zeXNsb2cnO1xuaW1wb3J0IHsgU2ltdWxhdGVMb2NhdGlvblNlcnZpY2UsIFNJTVVMQVRFX0xPQ0FUSU9OX1NFUlZJQ0VfTkFNRSB9IGZyb20gJy4vc2ltdWxhdGVsb2NhdGlvbic7XG5pbXBvcnQgeyBXZWJJbnNwZWN0b3JTZXJ2aWNlLCBXRUJfSU5TUEVDVE9SX1NFUlZJQ0VfTkFNRSB9IGZyb20gJy4vd2ViaW5zcGVjdG9yJztcbmltcG9ydCB7IEluc3RhbGxhdGlvblByb3h5U2VydmljZSwgSU5TVEFMTEFUSU9OX1BST1hZX1NFUlZJQ0VfTkFNRSB9IGZyb20gJy4vaW5zdGFsbGF0aW9uLXByb3h5JztcbmltcG9ydCB7IEFmY1NlcnZpY2UsIEFGQ19TRVJWSUNFX05BTUUgfSBmcm9tICcuL2FmYyc7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25Qcm94eVNlcnZpY2UsIE5PVElGSUNBVElPTl9QUk9YWV9TRVJWSUNFX05BTUUgfSBmcm9tICcuL25vdGlmaWNhdGlvbi1wcm94eSc7XG5pbXBvcnQgeyBIb3VzZUFycmVzdFNlcnZpY2UsIEhPVVNFX0FSUkVTVF9TRVJWSUNFX05BTUUgfSBmcm9tICcuL2hvdXNlLWFycmVzdCc7XG5pbXBvcnQgeyBJbnN0cnVtZW50U2VydmljZSwgSU5TVFJVTUVOVF9TRVJWSUNFX05BTUVfVkVSU0lPTl8xNCwgSU5TVFJVTUVOVF9TRVJWSUNFX05BTUV9IGZyb20gJy4vaW5zdHJ1bWVudCc7XG5pbXBvcnQgeyBUZXN0bWFuYWdlcmRTZXJ2aWNlLCBURVNUTUFOQUdFUkRfU0VSVklDRV9OQU1FX1ZFUlNJT05fMTQsIFRFU1RNQU5BR0VSRF9TRVJWSUNFX05BTUUgfSBmcm9tICcuL3Rlc3RtYW5hZ2VyZCc7XG5pbXBvcnQgeyBNQ0luc3RhbGxQcm94eVNlcnZpY2UsIE1DX0lOU1RBTExfU0VSVklDRV9OQU1FfSBmcm9tICcuL21jaW5zdGFsbCc7XG5pbXBvcnQgUGxpc3RTZXJ2aWNlIGZyb20gJy4vcGxpc3Qtc2VydmljZSc7XG5pbXBvcnQgc2VtdmVyIGZyb20gJ3NlbXZlcic7XG5cbmNvbnN0IENSQVNIX0xPR19TRVJWSUNFX05BTUUgPSAnY29tLmFwcGxlLmNyYXNocmVwb3J0Y29weW1vYmlsZSc7XG5jb25zdCBJTlNUUlVNRU5UX0hBTkRTSEFLRV9WRVJTSU9OID0gMTQ7XG5jb25zdCBURVNUTUFOQUdFUkRfSEFORFNIQUtFX1ZFUlNJT04gPSAxNDtcblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRTeXNsb2dTZXJ2aWNlICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qgc29ja2V0ID0gYXdhaXQgc3RhcnRTZXJ2aWNlKHVkaWQsIFNZU0xPR19TRVJWSUNFX05BTUUsIG9wdHMuc29ja2V0KTtcbiAgcmV0dXJuIG5ldyBTeXNsb2dTZXJ2aWNlKHNvY2tldCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0U2ltdWxhdGVMb2NhdGlvblNlcnZpY2UgKHVkaWQsIG9wdHMgPSB7fSkge1xuICBjb25zdCBzb2NrZXQgPSBhd2FpdCBzdGFydFNlcnZpY2UodWRpZCwgU0lNVUxBVEVfTE9DQVRJT05fU0VSVklDRV9OQU1FLCBvcHRzLnNvY2tldCk7XG4gIHJldHVybiBuZXcgU2ltdWxhdGVMb2NhdGlvblNlcnZpY2Uoc29ja2V0KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRXZWJJbnNwZWN0b3JTZXJ2aWNlICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qgb3NWZXJzaW9uID0gb3B0cy5vc1ZlcnNpb24gfHwgYXdhaXQgZ2V0T1NWZXJzaW9uKHVkaWQsIG9wdHMuc29ja2V0KTtcbiAgY29uc3QgaXNTaW11bGF0b3IgPSAhIW9wdHMuaXNTaW11bGF0b3I7XG4gIGNvbnN0IHZlcmJvc2UgPSAhIW9wdHMudmVyYm9zZTtcbiAgY29uc3QgdmVyYm9zZUhleER1bXAgPSAhIW9wdHMudmVyYm9zZUhleER1bXA7XG4gIGNvbnN0IHNvY2tldENodW5rU2l6ZSA9IG9wdHMuc29ja2V0Q2h1bmtTaXplO1xuICBjb25zdCBtYXhGcmFtZUxlbmd0aCA9IG9wdHMubWF4RnJhbWVMZW5ndGg7XG4gIGNvbnN0IHNlbXZlclZlcnNpb24gPSBzZW12ZXIuY29lcmNlKG9zVmVyc2lvbik7XG4gIGlmICghc2VtdmVyVmVyc2lvbikge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGNyZWF0ZSBhIHNlbXZlciB2ZXJzaW9uIG91dCBvZiAnJHtvc1ZlcnNpb259J2ApO1xuICB9XG4gIGlmIChvcHRzLnNvY2tldCkge1xuICAgIHJldHVybiBuZXcgV2ViSW5zcGVjdG9yU2VydmljZSh7XG4gICAgICBtYWpvck9zVmVyc2lvbjogc2VtdmVyVmVyc2lvbi5tYWpvcixcbiAgICAgIGlzU2ltdWxhdG9yLFxuICAgICAgc29ja2V0Q2h1bmtTaXplLFxuICAgICAgdmVyYm9zZSxcbiAgICAgIHZlcmJvc2VIZXhEdW1wLFxuICAgICAgc29ja2V0Q2xpZW50OiBvcHRzLnNvY2tldCxcbiAgICAgIG1heEZyYW1lTGVuZ3RoLFxuICAgIH0pO1xuICB9XG4gIGNvbnN0IHNvY2tldCA9IGF3YWl0IHN0YXJ0U2VydmljZSh1ZGlkLCBXRUJfSU5TUEVDVE9SX1NFUlZJQ0VfTkFNRSwgdW5kZWZpbmVkKTtcbiAgcmV0dXJuIG5ldyBXZWJJbnNwZWN0b3JTZXJ2aWNlKHtcbiAgICBtYWpvck9zVmVyc2lvbjogc2VtdmVyVmVyc2lvbi5tYWpvcixcbiAgICBpc1NpbXVsYXRvcixcbiAgICBzb2NrZXRDaHVua1NpemUsXG4gICAgdmVyYm9zZSxcbiAgICB2ZXJib3NlSGV4RHVtcCxcbiAgICBzb2NrZXRDbGllbnQ6IHNvY2tldCxcbiAgICBtYXhGcmFtZUxlbmd0aCxcbiAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0SW5zdGFsbGF0aW9uUHJveHlTZXJ2aWNlICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qgc29ja2V0ID0gYXdhaXQgc3RhcnRTZXJ2aWNlKHVkaWQsIElOU1RBTExBVElPTl9QUk9YWV9TRVJWSUNFX05BTUUsIG9wdHMuc29ja2V0KTtcbiAgcmV0dXJuIG5ldyBJbnN0YWxsYXRpb25Qcm94eVNlcnZpY2UobmV3IFBsaXN0U2VydmljZShzb2NrZXQpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRBZmNTZXJ2aWNlICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qgc29ja2V0ID0gYXdhaXQgc3RhcnRTZXJ2aWNlKHVkaWQsIEFGQ19TRVJWSUNFX05BTUUsIG9wdHMuc29ja2V0KTtcbiAgcmV0dXJuIG5ldyBBZmNTZXJ2aWNlKHNvY2tldCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0Q3Jhc2hMb2dTZXJ2aWNlICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qgc29ja2V0ID0gYXdhaXQgc3RhcnRTZXJ2aWNlKHVkaWQsIENSQVNIX0xPR19TRVJWSUNFX05BTUUsIG9wdHMuc29ja2V0KTtcbiAgcmV0dXJuIG5ldyBBZmNTZXJ2aWNlKHNvY2tldCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0Tm90aWZpY2F0aW9uUHJveHlTZXJ2aWNlICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qgc29ja2V0ID0gYXdhaXQgc3RhcnRTZXJ2aWNlKHVkaWQsIE5PVElGSUNBVElPTl9QUk9YWV9TRVJWSUNFX05BTUUsIG9wdHMuc29ja2V0KTtcbiAgcmV0dXJuIG5ldyBOb3RpZmljYXRpb25Qcm94eVNlcnZpY2Uoc29ja2V0KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRIb3VzZUFycmVzdFNlcnZpY2UgKHVkaWQsIG9wdHMgPSB7fSkge1xuICBjb25zdCBzb2NrZXQgPSBhd2FpdCBzdGFydFNlcnZpY2UodWRpZCwgSE9VU0VfQVJSRVNUX1NFUlZJQ0VfTkFNRSwgb3B0cy5zb2NrZXQpO1xuICByZXR1cm4gbmV3IEhvdXNlQXJyZXN0U2VydmljZShzb2NrZXQpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydEluc3RydW1lbnRTZXJ2aWNlICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qgb3NWZXJzaW9uID0gb3B0cy5vc1ZlcnNpb24gfHwgYXdhaXQgZ2V0T1NWZXJzaW9uKHVkaWQsIG9wdHMuc29ja2V0KTtcbiAgcmV0dXJuIG5ldyBJbnN0cnVtZW50U2VydmljZShcbiAgcGFyc2VJbnQob3NWZXJzaW9uLnNwbGl0KCcuJylbMF0sIDEwKSA8IElOU1RSVU1FTlRfSEFORFNIQUtFX1ZFUlNJT05cbiAgICA/IGF3YWl0IHN0YXJ0U2VydmljZSh1ZGlkLCBJTlNUUlVNRU5UX1NFUlZJQ0VfTkFNRSwgb3B0cy5zb2NrZXQsIHRydWUpXG4gICAgOiBhd2FpdCBzdGFydFNlcnZpY2UodWRpZCwgSU5TVFJVTUVOVF9TRVJWSUNFX05BTUVfVkVSU0lPTl8xNCwgb3B0cy5zb2NrZXQpXG4gICk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0VGVzdG1hbmFnZXJkU2VydmljZSAodWRpZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IG9zVmVyc2lvbiA9IG9wdHMub3NWZXJzaW9uIHx8IGF3YWl0IGdldE9TVmVyc2lvbih1ZGlkLCBvcHRzLnNvY2tldCk7XG4gIHJldHVybiBuZXcgVGVzdG1hbmFnZXJkU2VydmljZShcbiAgICBwYXJzZUludChvc1ZlcnNpb24uc3BsaXQoJy4nKVswXSwgMTApIDwgVEVTVE1BTkFHRVJEX0hBTkRTSEFLRV9WRVJTSU9OXG4gICAgICA/IGF3YWl0IHN0YXJ0U2VydmljZSh1ZGlkLCBURVNUTUFOQUdFUkRfU0VSVklDRV9OQU1FLCBvcHRzLnNvY2tldCwgdHJ1ZSlcbiAgICAgIDogYXdhaXQgc3RhcnRTZXJ2aWNlKHVkaWQsIFRFU1RNQU5BR0VSRF9TRVJWSUNFX05BTUVfVkVSU0lPTl8xNCwgb3B0cy5zb2NrZXQpXG4gICk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0TUNJbnN0YWxsU2VydmljZSAodWRpZCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHNvY2tldCA9IGF3YWl0IHN0YXJ0U2VydmljZSh1ZGlkLCBNQ19JTlNUQUxMX1NFUlZJQ0VfTkFNRSwgb3B0cy5zb2NrZXQpO1xuICByZXR1cm4gbmV3IE1DSW5zdGFsbFByb3h5U2VydmljZShuZXcgUGxpc3RTZXJ2aWNlKHNvY2tldCkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydFNlcnZpY2UgKHVkaWQsIHNlcnZpY2VOYW1lLCBzb2NrZXQsIGhhbmRzaGFrZU9ubHkgPSBmYWxzZSkge1xuICBjb25zdCBsb2NrZG93biA9IGF3YWl0IHN0YXJ0TG9ja2Rvd25TZXNzaW9uKHVkaWQsIHNvY2tldCk7XG4gIHRyeSB7XG4gICAgY29uc3Qgc2VydmljZSA9IGF3YWl0IGxvY2tkb3duLnN0YXJ0U2VydmljZShzZXJ2aWNlTmFtZSk7XG4gICAgaWYgKHNlcnZpY2UuRW5hYmxlU2VydmljZVNTTCkge1xuICAgICAgcmV0dXJuIGF3YWl0IGNvbm5lY3RQb3J0U1NMKHVkaWQsIHNlcnZpY2UuUG9ydCwgc29ja2V0LCBoYW5kc2hha2VPbmx5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGF3YWl0IGNvbm5lY3RQb3J0KHVkaWQsIHNlcnZpY2UuUG9ydCwgc29ja2V0KTtcbiAgICB9XG4gIH0gZmluYWxseSB7XG4gICAgbG9ja2Rvd24uY2xvc2UoKTtcbiAgfVxufVxuXG5leHBvcnQge1xuICBzdGFydFN5c2xvZ1NlcnZpY2UsIHN0YXJ0V2ViSW5zcGVjdG9yU2VydmljZSxcbiAgc3RhcnRJbnN0YWxsYXRpb25Qcm94eVNlcnZpY2UsIHN0YXJ0U2ltdWxhdGVMb2NhdGlvblNlcnZpY2UsXG4gIHN0YXJ0QWZjU2VydmljZSwgc3RhcnRDcmFzaExvZ1NlcnZpY2UsIHN0YXJ0Tm90aWZpY2F0aW9uUHJveHlTZXJ2aWNlLFxuICBzdGFydEhvdXNlQXJyZXN0U2VydmljZSwgc3RhcnRJbnN0cnVtZW50U2VydmljZSwgc3RhcnRUZXN0bWFuYWdlcmRTZXJ2aWNlLFxuICBzdGFydE1DSW5zdGFsbFNlcnZpY2Vcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUFBLFVBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLE9BQUEsR0FBQUQsT0FBQTtB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